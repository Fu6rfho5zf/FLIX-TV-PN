<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLIX TV Max - Painel Administrativo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --danger-color: #f72585;
            --success-color: #4cc9f0;
            --warning-color: #ff9e00;
            --dark-bg: #1a1a2e;
            --card-bg: #16213e;
            --text-light: #ffffff;
            --text-gray: #b0b0b0;
            --sidebar-bg: #0f3460;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
        }
 
        /* Sidebar Fixada */
        .sidebar {
            width: 400px;
            background-color: var(--sidebar-bg);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 3px 0 15px rgba(0,0,0,0.4);
            padding: 25px 0;
        }

        .main-content {
            flex: 1;
            margin-left: 400px;
            padding: 25px;
            min-height: 100vh;
        }

        @media (max-width: 1200px) {
            .sidebar {
                width: 350px;
            }
            .main-content {
                margin-left: 350px;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                width: 300px;
                padding: 15px 0;
            }
            .main-content {
                margin-left: 0;
            }
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
                width: 300px;
            }
            .sidebar.active {
                transform: translateX(0);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 280px;
            }
        }

        @media (max-width: 576px) {
            .sidebar {
                width: 250px;
                padding: 15px 0;
            }
        }

        .logo {
            text-align: center;
            margin-bottom: 40px;
            padding: 0 25px;
        }

        .logo h3 {
            color: var(--text-light);
            font-weight: 700;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .logo span {
            color: var(--success-color);
        }

        .logo p {
            color: var(--text-gray);
            font-size: 14px;
            margin: 0;
        }

        /* Menu de Páginas */
        .pages-menu {
            margin-bottom: 40px;
            padding: 0 20px;
        }

        .pages-title {
            color: var(--text-gray);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 20px;
            padding-left: 15px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pages-title i {
            transition: transform 0.3s;
        }

        .pages-title.collapsed i {
            transform: rotate(180deg);
        }

        .page-list {
            transition: max-height 0.3s ease;
            overflow: hidden;
            max-height: 500px;
        }

        .page-list.collapsed {
            max-height: 0;
        }

        .page-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            color: var(--text-gray);
            text-decoration: none;
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .page-item:hover, .page-item.active {
            background-color: var(--primary-color);
            color: white;
            transform: translateX(5px);
        }

        .page-icon {
            margin-right: 16px;
            font-size: 20px;
            width: 30px;
            text-align: center;
        }

        .page-text {
            font-size: 16px;
            font-weight: 600;
        }

        /* Menu de Categorias - MODIFICADO: Fechado por padrão */
        .categories-menu {
            padding: 0 20px;
            margin-bottom: 30px;
        }

        .categories-title {
            color: var(--text-gray);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 20px;
            padding-left: 15px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .categories-title i {
            transition: transform 0.3s;
        }

        .categories-title.collapsed i {
            transform: rotate(180deg);
        }

        .category-list {
            max-height: 350px;
            overflow-y: auto;
            margin-bottom: 15px;
            transition: max-height 0.3s ease;
        }

        .category-list.collapsed {
            max-height: 0;
            overflow: hidden;
        }

        .category-item {
            display: flex;
            align-items: center;
            padding: 12px 18px;
            color: var(--text-gray);
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 5px;
            transition: all 0.2s;
            cursor: pointer;
            font-size: 14px;
        }

        .category-item:hover {
            background-color: rgba(255,255,255,0.15);
            color: white;
            transform: translateX(3px);
        }

        .category-item.active {
            background-color: var(--primary-color);
            color: white;
            font-weight: 700;
        }

        .category-icon {
            margin-right: 12px;
            font-size: 16px;
            width: 24px;
            text-align: center;
        }

        .category-text {
            flex: 1;
        }

        /* Scrollbar da sidebar */
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.08);
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        /* Cards */
        .dashboard-card {
            background: linear-gradient(135deg, var(--card-bg) 0%, #1e3a8a 100%);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: none;
            transition: transform 0.3s, box-shadow 0.3s;
            height: 100%;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .card-icon {
            font-size: 40px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .card-title {
            font-size: 18px;
            color: var(--text-gray);
            margin-bottom: 10px;
        }

        .card-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-light);
        }

        .card-subtitle {
            font-size: 14px;
            color: var(--text-gray);
        }

        /* Forms */
        .form-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .form-label {
            color: var(--text-light);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-control, .form-select {
            background-color: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: var(--text-light);
            padding: 12px 15px;
            border-radius: 8px;
        }

        .form-control:focus, .form-select:focus {
            background-color: rgba(255,255,255,0.15);
            border-color: var(--primary-color);
            color: var(--text-light);
            box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
        }

        .form-control::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .btn-admin {
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary-admin {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary-admin:hover {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-success-admin {
            background-color: var(--success-color);
            color: white;
        }

        .btn-warning-admin {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-danger-admin {
            background-color: var(--danger-color);
            color: white;
        }

        /* Tables */
        .table-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
        }

        .admin-table {
            width: 100%;
            color: var(--text-light);
            border-collapse: separate;
            border-spacing: 0;
        }

        .admin-table thead {
            background-color: var(--primary-color);
        }

        .admin-table th {
            padding: 15px;
            font-weight: 600;
            border: none;
        }

        .admin-table tbody tr {
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: background-color 0.3s;
        }

        .admin-table tbody tr:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .admin-table td {
            padding: 15px;
            border: none;
            vertical-align: middle;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background-color: rgba(76, 201, 240, 0.2);
            color: var(--success-color);
        }

        .status-inactive {
            background-color: rgba(247, 37, 133, 0.2);
            color: var(--danger-color);
        }

        /* Tabs */
        .nav-tabs-admin {
            border-bottom: 3px solid rgba(255,255,255,0.15);
            margin-bottom: 25px;
        }

        .nav-tabs-admin .nav-link {
            color: var(--text-gray);
            border: none;
            padding: 16px 35px;
            border-radius: 10px 10px 0 0;
            margin-right: 8px;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .nav-tabs-admin .nav-link:hover {
            background-color: rgba(255,255,255,0.1);
            color: var(--text-light);
        }

        .nav-tabs-admin .nav-link.active {
            background-color: var(--primary-color);
            color: white;
            position: relative;
        }

        .nav-tabs-admin .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--success-color);
        }

        /* Modal */
        .modal-admin {
            background-color: rgba(0,0,0,0.8);
        }

        .modal-admin .modal-content {
            background-color: var(--card-bg);
            border: none;
            border-radius: 12px;
            color: var(--text-light);
        }

        .modal-admin .modal-header {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .modal-admin .modal-footer {
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        /* GitHub Section */
        .github-section {
            background: linear-gradient(135deg, #24292e 0%, #0d1117 100%);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .github-token-input {
            background-color: rgba(255,255,255,0.1);
            border: 1px solid #30363d;
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
        }

        .github-token-input:focus {
            background-color: rgba(255,255,255,0.15);
            border-color: #58a6ff;
            color: white;
            box-shadow: 0 0 0 0.25rem rgba(88, 166, 255, 0.25);
        }

        .btn-github {
            background-color: #238636;
            color: white;
            border: none;
        }

        .btn-github:hover {
            background-color: #2ea043;
            color: white;
        }

        /* Loading */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Content Preview */
        .content-preview {
            max-width: 300px;
            background-color: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .preview-image {
            width: 100%;
            height: 150px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 6px;
            margin-bottom: 10px;
            background-size: cover;
            background-position: center;
        }

        .preview-title {
            font-weight: 600;
            color: white;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .preview-meta {
            font-size: 12px;
            color: var(--text-gray);
        }

        /* Code Generator */
        .code-generator {
            background-color: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .generated-code {
            font-family: monospace;
            background-color: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            word-break: break-all;
            color: #8b949e;
        }

        /* Alert */
        .alert-admin {
            background-color: rgba(255,255,255,0.1);
            border: none;
            border-left: 4px solid var(--primary-color);
            color: var(--text-light);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .alert-success-admin {
            border-left-color: var(--success-color);
        }

        .alert-danger-admin {
            border-left-color: var(--danger-color);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        /* Categories Grid */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .category-card {
            background-color: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .category-card:hover {
            background-color: rgba(255,255,255,0.1);
            transform: translateY(-3px);
        }

        .category-card.active {
            border-color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.1);
        }

        .category-card-icon {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .category-card-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .category-card-count {
            font-size: 12px;
            color: var(--text-gray);
        }

        /* Toggle Button para Mobile */
        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background-color: var(--primary-color);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        @media (max-width: 992px) {
            .sidebar-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
        }

        /* Footer da Sidebar */
        .sidebar-footer {
            margin-top: 40px;
            padding: 25px 20px 0;
            border-top: 2px solid rgba(255,255,255,0.15);
        }

        .sidebar-footer .text-center {
            padding: 10px;
        }

        .sidebar-footer .text-muted {
            font-size: 13px;
        }

        .sidebar-footer #currentAdmin {
            font-weight: 700;
            color: var(--success-color);
            font-size: 14px;
        }

        /* Botão de Carregar RSS */
        .btn-rss {
            background-color: #ff6b35;
            color: white;
            border: none;
        }

        .btn-rss:hover {
            background-color: #ff8b5e;
            color: white;
        }

        /* TMDB Search Results */
        .tmdb-results {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 10px;
        }

        .tmdb-result-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .tmdb-result-item:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .tmdb-result-item:last-child {
            border-bottom: none;
        }

        .tmdb-poster {
            width: 50px;
            height: 75px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 15px;
        }

        .tmdb-info {
            flex: 1;
        }

        .tmdb-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .tmdb-year {
            font-size: 12px;
            color: var(--text-gray);
        }

        /* IPTV Section */
        .iptv-section {
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        /* Edit Icon for Settings */
        .edit-icon-btn {
            background: none;
            border: none;
            color: var(--text-gray);
            cursor: pointer;
            padding: 5px;
            margin-left: 10px;
        }

        .edit-icon-btn:hover {
            color: var(--primary-color);
        }

        /* Category Content View */
        .category-content-view {
            display: none;
        }

        .category-content-view.active {
            display: block;
        }

        /* IPTV Item Edit Modal */
        .iptv-item-edit {
            background-color: rgba(0,0,0,0.5);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .iptv-category-channels {
            max-height: 400px;
            overflow-y: auto;
        }

        .channel-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: background-color 0.2s;
        }

        .channel-item:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .channel-logo {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            margin-right: 15px;
            object-fit: cover;
            background-color: rgba(255,255,255,0.1);
        }

        .channel-info {
            flex: 1;
        }

        .channel-name {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .channel-url {
            font-size: 12px;
            color: var(--text-gray);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* EPG Input */
        .epg-input-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .epg-input-container input {
            flex: 1;
        }

        .iptv-channel-actions {
            display: flex;
            gap: 5px;
        }

        /* Netflix Style Content Grid */
        .netflix-grid {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 20px 0;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) transparent;
        }

        .netflix-grid::-webkit-scrollbar {
            height: 8px;
        }

        .netflix-grid::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
        }

        .netflix-grid::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        .netflix-item {
            flex: 0 0 auto;
            width: 200px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .netflix-item:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .netflix-item img {
            width: 100%;
            height: 280px;
            object-fit: cover;
        }

        .netflix-item-info {
            padding: 15px;
        }

        .netflix-item-title {
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .netflix-item-meta {
            font-size: 12px;
            color: var(--text-gray);
        }

        /* Content Actions */
        .content-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: none;
            gap: 5px;
            z-index: 10;
        }

        .netflix-item:hover .content-actions {
            display: flex;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(0,0,0,0.8);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .action-btn:hover {
            background: var(--primary-color);
        }

        /* Temporary Category */
        .temp-category-badge {
            background: var(--warning-color);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 5px;
        }

        /* Content Search Bar */
        .content-search-bar {
            background: rgba(255,255,255,0.05);
            border-radius: 50px;
            padding: 12px 20px;
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            width: 100%;
            margin-bottom: 20px;
        }

        .content-search-bar:focus {
            outline: none;
            border-color: var(--primary-color);
            background: rgba(255,255,255,0.08);
        }

        /* Modal para Carregar JSON */
        .json-modal .modal-content {
            width: 90%;
            max-width: 1200px;
        }

        .json-tabs {
            display: flex;
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 20px;
        }

        .json-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: var(--card-bg);
            border: none;
            color: var(--text-gray);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .json-tab.active {
            background: var(--primary-color);
            color: white;
        }

        .json-tab:hover:not(.active) {
            background: rgba(67, 97, 238, 0.3);
        }

        .json-content-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .json-column {
            flex: 1;
            min-height: 500px;
            max-height: 600px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }

        .json-column h5 {
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }

        .json-item {
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .json-item:hover {
            background: rgba(67, 97, 238, 0.2);
            transform: translateX(5px);
        }

        .json-item.selected {
            background: rgba(67, 97, 238, 0.3);
            border-left: 4px solid var(--primary-color);
        }

        .json-item-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .json-item-category {
            font-size: 12px;
            color: var(--text-gray);
        }

        .json-preview {
            flex: 0 0 300px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }

        .json-preview img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .json-file-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .json-file-item {
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .json-file-name {
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .json-file-size {
            font-size: 12px;
            color: var(--text-gray);
            margin-left: 10px;
        }

        /* Botão Carregar JSON */
        .btn-load-json {
            background-color: #8a2be2;
            color: white;
            border: none;
        }

        .btn-load-json:hover {
            background-color: #9b3be2;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Toggle Button para Mobile -->
    <button class="sidebar-toggle" id="sidebarToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div id="loadingText" style="color: white; font-size: 18px;">Processando...</div>
    </div>

    <!-- Sidebar Fixada -->
    <div class="sidebar" id="sidebar">
        <div class="logo">
            <h3><i class="fas fa-crown"></i> FLIX TV <span>Max</span> Admin</h3>
            <p>Painel de Controle Premium</p>
        </div>
        
        <!-- Menu de Páginas -->
        <div class="pages-menu">
            <div class="pages-title" id="pagesTitle">
                Páginas do App
                <i class="fas fa-chevron-up"></i>
            </div>
            <div class="page-list" id="pageList">
                <a href="#" class="page-item active" data-page="home">
                    <div class="page-icon"><i class="fas fa-home"></i></div>
                    <div class="page-text">HOME</div>
                </a>
                <a href="#" class="page-item" data-page="filmes">
                    <div class="page-icon"><i class="fas fa-film"></i></div>
                    <div class="page-text">FILMES</div>
                </a>
                <a href="#" class="page-item" data-page="series">
                    <div class="page-icon"><i class="fas fa-tv"></i></div>
                    <div class="page-text">SÉRIES</div>
                </a>
                <a href="#" class="page-item" data-page="tv">
                    <div class="page-icon"><i class="fas fa-satellite-dish"></i></div>
                    <div class="page-text">TV AO VIVO</div>
                </a>
                <a href="#" class="page-item" data-page="epg">
                    <div class="page-icon"><i class="fas fa-tv"></i></div>
                    <div class="page-text">EPG</div>
                </a>
            </div>
        </div>

        <!-- Menu de Categorias (Dinâmico) - MODIFICADO: Inicialmente fechado -->
        <div class="categories-menu">
            <div class="categories-title collapsed" id="categoriesTitle">
                Categorias da Página
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="category-list collapsed" id="categoryList">
                <!-- Categorias serão carregadas dinamicamente -->
            </div>
        </div>

        <!-- Menu Administrativo -->
        <div class="pages-menu">
            <div class="pages-title">Administração</div>
            <div class="page-list">
                <a href="#" class="page-item" data-section="dashboard">
                    <div class="page-icon"><i class="fas fa-tachometer-alt"></i></div>
                    <div class="page-text">Dashboard</div>
                </a>
                <a href="#" class="page-item" data-section="content">
                    <div class="page-icon"><i class="fas fa-edit"></i></div>
                    <div class="page-text">Gerenciar Conteúdo</div>
                </a>
                <a href="#" class="page-item" data-section="iptv">
                    <div class="page-icon"><i class="fas fa-tv"></i></div>
                    <div class="page-text">IPTV por Conteúdo</div>
                </a>
                <a href="#" class="page-item" data-section="github">
                    <div class="page-icon"><i class="fab fa-github"></i></div>
                    <div class="page-text">GitHub Sync</div>
                </a>
                <a href="#" class="page-item" data-section="users">
                    <div class="page-icon"><i class="fas fa-users"></i></div>
                    <div class="page-text">Usuários</div>
                </a>
                <a href="#" class="page-item" data-section="codes">
                    <div class="page-icon"><i class="fas fa-gift"></i></div>
                    <div class="page-text">Códigos</div>
                </a>
                <a href="#" class="page-item" data-section="import">
                    <div class="page-icon"><i class="fas fa-file-import"></i></div>
                    <div class="page-text">Importar IPTV</div>
                </a>
                <a href="#" class="page-item" data-section="settings">
                    <div class="page-icon"><i class="fas fa-cog"></i></div>
                    <div class="page-text">Configurações</div>
                </a>
                <a href="WEB.html" target="_blank" class="page-item">
                    <div class="page-icon"><i class="fas fa-external-link-alt"></i></div>
                    <div class="page-text">Ver App</div>
                </a>
                <a href="#" class="page-item" id="logoutBtn">
                    <div class="page-icon"><i class="fas fa-sign-out-alt"></i></div>
                    <div class="page-text">Sair</div>
                </a>
            </div>
        </div>

        <div class="sidebar-footer">
            <div class="text-center">
                <small class="text-muted">Conectado como: <br><span id="currentAdmin">Administrador</span></small>
                <br>
                <small class="text-muted" style="font-size: 11px; margin-top: 5px; display: block;">
                    <i class="fas fa-shield-alt me-1"></i>Sistema Seguro
                </small>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboardSection" class="admin-section">
            <h2 class="mb-4"><i class="fas fa-tachometer-alt me-2"></i>Dashboard</h2>
            
            <div class="row">
                <div class="col-md-3">
                    <div class="dashboard-card">
                        <div class="card-icon"><i class="fas fa-film"></i></div>
                        <div class="card-title">Total Conteúdos</div>
                        <div class="card-value" id="totalContents">0</div>
                        <div class="card-subtitle">Todas as páginas</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card">
                        <div class="card-icon"><i class="fas fa-layer-group"></i></div>
                        <div class="card-title">Categorias</div>
                        <div class="card-value" id="totalCategories">0</div>
                        <div class="card-subtitle">Ativas no sistema</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card">
                        <div class="card-icon"><i class="fas fa-users"></i></div>
                        <div class="card-title">Total Usuários</div>
                        <div class="card-value" id="totalUsers">0</div>
                        <div class="card-subtitle">Ativos: <span id="activeUsers">0</span></div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card">
                        <div class="card-icon"><i class="fas fa-sync-alt"></i></div>
                        <div class="card-title">Última Sinc</div>
                        <div class="card-value" id="lastSync">-</div>
                        <div class="card-subtitle" id="syncStatus">Nunca sincronizado</div>
                    </div>
                </div>
            </div>
            
            <!-- Seleção de Página e Categoria -->
            <div class="form-container mt-4">
                <h4 class="mb-3"><i class="fas fa-filter me-2"></i>Filtrar por Página e Categoria</h4>
                <div class="row">
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label class="form-label">Página</label>
                            <select class="form-select" id="filterPage" onchange="changePage()">
                                <option value="home">HOME</option>
                                <option value="filmes">FILMES</option>
                                <option value="series">SÉRIES</option>
                                <option value="tv">TV AO VIVO</option>
                                <option value="epg">EPG</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="mb-3">
                            <label class="form-label">Categoria</label>
                            <div class="categories-grid" id="categoriesGrid">
                                <!-- Categorias serão carregadas aqui -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- View de Conteúdos por Categoria -->
            <div class="form-container mt-4" id="categoryContentView">
                <h4 class="mb-3"><i class="fas fa-list me-2"></i>Conteúdos da Categoria: <span id="currentCategoryName"></span></h4>
                
                <!-- Barra de busca -->
                <div class="mb-3">
                    <input type="text" class="content-search-bar" id="searchCategoryContent" 
                           placeholder="Buscar conteúdo nesta categoria..." onkeyup="searchCategoryContent()">
                </div>
                
                <div class="table-container">
                    <table class="admin-table" id="categoryContentsTable">
                        <thead>
                            <tr>
                                <th>Título</th>
                                <th>Página</th>
                                <th>Categoria</th>
                                <th>Data</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="categoryContentsTableBody">
                            <!-- Content rows will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="row mt-4">
                <div class="col-md-8">
                    <div class="form-container">
                        <h4 class="mb-3"><i class="fas fa-bolt me-2"></i>Ações Rápidas</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <button class="btn btn-primary-admin btn-admin w-100 mb-3" onclick="switchSection('content')">
                                    <i class="fas fa-plus me-2"></i>Adicionar Conteúdo
                                </button>
                                <button class="btn btn-success-admin btn-admin w-100 mb-3" onclick="switchSection('iptv')">
                                    <i class="fas fa-tv me-2"></i>Gerenciar IPTV
                                </button>
                            </div>
                            <div class="col-md-6">
                                <button class="btn btn-warning-admin btn-admin w-100 mb-3" onclick="switchSection('users')">
                                    <i class="fas fa-user-plus me-2"></i>Criar Usuário
                                </button>
                                <button class="btn btn-primary-admin btn-admin w-100 mb-3" onclick="switchSection('codes')">
                                    <i class="fas fa-gift me-2"></i>Gerar Código
                                </button>
                            </div>
                        </div>
                        
                        <!-- Botão para Carregar RSS -->
                        <div class="mt-3">
                            <button class="btn btn-rss btn-admin w-100" onclick="loadAllRSSFeeds()">
                                <i class="fas fa-cloud-download-alt me-2"></i>Carregar Conteúdos do GitHub
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-container">
                        <h4 class="mb-3"><i class="fas fa-chart-line me-2"></i>Estatísticas</h4>
                        <div id="statsContent">
                            <p><i class="fas fa-circle text-success me-2"></i> Sistema: <strong>Online</strong></p>
                            <p><i class="fas fa-database me-2"></i> Armazenamento: <strong id="storageUsed">0 MB</strong></p>
                            <p><i class="fas fa-clock me-2"></i> Última Atividade: <strong id="lastActivity">-</strong></p>
                            <p><i class="fas fa-history me-2"></i> Categorias Temp: <strong id="tempCategoriesCount">0</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- IPTV por Conteúdo Section -->
        <section id="iptvSection" class="admin-section" style="display: none;">
            <h2 class="mb-4"><i class="fas fa-tv me-2"></i>IPTV por Conteúdo</h2>
            
            <div class="iptv-section">
                <h4 class="mb-3"><i class="fas fa-satellite-dish me-2"></i>Gerenciar Conteúdo IPTV Individual</h4>
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-container">
                            <h5 class="mb-3">Carregar Lista IPTV</h5>
                            <div class="mb-3">
                                <label class="form-label">Carregar via URL</label>
                                <input type="url" class="form-control" id="iptvSingleUrl" 
                                       placeholder="https://exemplo.com/lista.m3u">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Ou Upload de Arquivo</label>
                                <input type="file" class="form-control" id="iptvSingleFile" accept=".m3u,.m3u8,.txt">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Tipo de Conteúdo</label>
                                <select class="form-select" id="iptvSingleType">
                                    <option value="tv">TV AO VIVO</option>
                                    <option value="filmes">FILMES</option>
                                    <option value="series">SÉRIES</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-primary-admin btn-admin w-100" onclick="loadSingleIPTV()">
                                <i class="fas fa-search me-2"></i>Carregar e Analisar
                            </button>
                        </div>
                    </div>
                    
                    <div class="col-md-8">
                        <div class="form-container">
                            <h5 class="mb-3">Filtrar Canais</h5>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="iptvSearchChannel" 
                                           placeholder="Buscar canal..." onkeyup="filterIPTVChannels()">
                                </div>
                                <div class="col-md-6">
                                    <select class="form-select" id="iptvFilterCategory" onchange="filterIPTVChannels()">
                                        <option value="">Todas Categorias</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="iptv-category-channels" id="iptvChannelsContainer">
                                <!-- Canais serão carregados aqui -->
                                <div class="text-center py-5">
                                    <i class="fas fa-tv fa-3x mb-3 text-muted"></i>
                                    <p class="text-muted">Carregue uma lista IPTV para ver os canais</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Formulário de Edição Individual -->
            <div class="form-container mt-4" id="iptvEditFormContainer" style="display: none;">
                <h4 class="mb-3"><i class="fas fa-edit me-2"></i>Editar Conteúdo IPTV</h4>
                <form id="iptvEditForm">
                    <input type="hidden" id="iptvEditId">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Título do Conteúdo</label>
                                <input type="text" class="form-control" id="iptvEditTitle" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">URL do Logo</label>
                                <input type="url" class="form-control" id="iptvEditLogo">
                                <div class="form-text">URL da imagem do logo do canal</div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">URL de Reprodução</label>
                                <input type="url" class="form-control" id="iptvEditUrl" required>
                                <div class="form-text">URL M3U8/MP4/TS do conteúdo</div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Descrição</label>
                                <textarea class="form-control" id="iptvEditDescription" rows="3"></textarea>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Página de Exibição</label>
                                <select class="form-select" id="iptvEditPage" required onchange="updateIPTVCategories()">
                                    <option value="">Selecione uma página</option>
                                    <option value="home">HOME</option>
                                    <option value="filmes">FILMES</option>
                                    <option value="series">SÉRIES</option>
                                    <option value="tv">TV AO VIVO</option>
                                    <option value="epg">EPG</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Categoria</label>
                                <select class="form-select" id="iptvEditCategory" required>
                                    <option value="">Selecione uma categoria</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">EPG (Guia de Programação)</label>
                                <div class="epg-input-container">
                                    <input type="text" class="form-control" id="iptvEditEpgId" 
                                           placeholder="ID do EPG (ex: Globo.br)">
                                    <input type="url" class="form-control" id="iptvEditEpgUrl" 
                                           placeholder="URL do EPG XMLTV">
                                </div>
                                <div class="form-text">Opcional - Para programação do canal</div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Formato do Conteúdo</label>
                                <select class="form-select" id="iptvEditFormat">
                                    <option value="m3u8">M3U8</option>
                                    <option value="mp4">MP4</option>
                                    <option value="ts">TS</option>
                                    <option value="m3u">M3U</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Qualidade</label>
                                <input type="text" class="form-control" id="iptvEditQuality" 
                                       placeholder="ex: HD, Full HD, 4K">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Busca TMDB -->
                    <div class="mb-3">
                        <label class="form-label">Buscar Dados no TMDB</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="iptvTmdbSearch" 
                                   placeholder="Buscar no TMDB para completar dados">
                            <button class="btn btn-primary-admin" type="button" onclick="searchIPTVTMDB()">
                                <i class="fas fa-search"></i> Buscar TMDB
                            </button>
                        </div>
                        <div id="iptvTmdbResults" class="tmdb-results" style="display: none;"></div>
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4">
                        <div>
                            <button type="submit" class="btn btn-success-admin btn-admin">
                                <i class="fas fa-save me-2"></i>Salvar Conteúdo
                            </button>
                            <button type="button" class="btn btn-primary-admin btn-admin" onclick="searchIPTVTMDB()">
                                <i class="fas fa-database me-2"></i>Buscar TMDB
                            </button>
                        </div>
                        <div>
                            <button type="button" class="btn btn-secondary btn-admin" onclick="cancelIPTVEdit()">
                                <i class="fas fa-times me-2"></i>Cancelar
                            </button>
                            <button type="button" class="btn btn-danger-admin btn-admin" onclick="deleteIPTVContent()">
                                <i class="fas fa-trash me-2"></i>Excluir
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- Nova Seção: Sistema de Criação de Categoria Temporária -->
            <div class="form-container mt-4">
                <h4 class="mb-3"><i class="fas fa-calendar-alt me-2"></i>Criar Categoria Temporária</h4>
                <form id="tempCategoryForm">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Nome da Categoria</label>
                                <input type="text" class="form-control" id="tempCategoryName" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Página</label>
                                <select class="form-select" id="tempCategoryPage" required>
                                    <option value="home">HOME</option>
                                    <option value="tv">TV AO VIVO</option>
                                    <option value="filmes">FILMES</option>
                                    <option value="series">SÉRIES</option>
                                    <option value="epg">EPG</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Duração (dias)</label>
                                <input type="number" class="form-control" id="tempCategoryDuration" min="1" max="365" value="7">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Data de Início</label>
                                <input type="date" class="form-control" id="tempCategoryStartDate" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Hora de Início</label>
                                <input type="time" class="form-control" id="tempCategoryStartTime" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success-admin btn-admin">
                            <i class="fas fa-plus me-2"></i>Criar Categoria
                        </button>
                        <button type="button" class="btn btn-primary-admin btn-admin" onclick="openTempCategoryManager()">
                            <i class="fas fa-list me-2"></i>Gerenciar Categorias
                        </button>
                        <button type="button" class="btn btn-warning-admin btn-admin" onclick="scheduleTempCategory()">
                            <i class="fas fa-clock me-2"></i>Agendar
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Content Management Section -->
        <section id="contentSection" class="admin-section" style="display: none;">
            <h2 class="mb-4"><i class="fas fa-film me-2"></i>Gerenciar Conteúdo</h2>
            
            <!-- Barra de Busca Global -->
            <div class="mb-4">
                <input type="text" class="content-search-bar" id="globalSearchContent" 
                       placeholder="Buscar conteúdo em todas as páginas..." onkeyup="globalSearchContent()">
            </div>
            
            <ul class="nav nav-tabs nav-tabs-admin" id="contentTabs">
                <li class="nav-item">
                    <a class="nav-link active" data-bs-toggle="tab" href="#tabAdd">Adicionar Conteúdo</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#tabEdit">Editar/Remover</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#tabView">Visualizar Todos</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#tabTemp">Categorias Temp</a>
                </li>
            </ul>
            
            <div class="tab-content">
                <!-- Add Content Tab -->
                <div class="tab-pane fade show active" id="tabAdd">
                    <div class="form-container">
                        <form id="addContentForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Título do Conteúdo</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="contentTitle" 
                                                   placeholder="Digite o título do conteúdo" required
                                                   onkeyup="searchTMDB(this.value)">
                                            <button class="btn btn-primary-admin" type="button" onclick="searchTMDB(document.getElementById('contentTitle').value)">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- TMDB Search Results -->
                                    <div id="tmdbResults" class="tmdb-results" style="display: none;"></div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">URL do Logo/Poster</label>
                                        <input type="url" class="form-control" id="contentPoster" 
                                               placeholder="https://exemplo.com/poster.jpg">
                                        <div class="form-text">Preview aparecerá automaticamente</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">URL de Reprodução</label>
                                        <input type="url" class="form-control" id="contentUrl" 
                                               placeholder="https://exemplo.com/video.m3u8" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Descrição</label>
                                        <textarea class="form-control" id="contentDescription" rows="3" 
                                                  placeholder="Descrição do conteúdo"></textarea>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Página de Exibição</label>
                                        <select class="form-select" id="contentPage" required onchange="updateCategoriesByPage()">
                                            <option value="">Selecione uma página</option>
                                            <option value="home">HOME</option>
                                            <option value="filmes">FILMES</option>
                                            <option value="series">SÉRIES</option>
                                            <option value="tv">TV AO VIVO</option>
                                            <option value="epg">EPG</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Categoria</label>
                                        <div class="input-group">
                                            <select class="form-select" id="contentCategory" required>
                                                <option value="">Primeiro selecione uma página</option>
                                            </select>
                                            <button class="btn btn-outline-light" type="button" onclick="createNewCategory()">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                        <div class="form-text">Categoria dentro da página selecionada</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Ano de Lançamento</label>
                                        <input type="number" class="form-control" id="contentYear" 
                                               placeholder="2024" min="1900" max="2030">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Gênero</label>
                                        <input type="text" class="form-control" id="contentGenre" 
                                               placeholder="Ação, Comédia, Drama">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Formato do Conteúdo</label>
                                        <div class="d-flex flex-wrap gap-2">
                                            <button type="button" class="btn btn-outline-light format-btn" data-format="m3u8">M3U8</button>
                                            <button type="button" class="btn btn-outline-light format-btn" data-format="mp4">MP4</button>
                                            <button type="button" class="btn btn-outline-light format-btn" data-format="ts">TS</button>
                                        </div>
                                        <input type="hidden" id="contentFormat" value="m3u8">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <div class="content-preview">
                                        <div class="preview-image" id="previewImage"></div>
                                        <div class="preview-title" id="previewTitle">Título do Conteúdo</div>
                                        <div class="preview-meta" id="previewMeta">Página: - | Categoria: -</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <button type="submit" class="btn btn-success-admin btn-admin">
                                    <i class="fas fa-plus me-2"></i>Adicionar Conteúdo
                                </button>
                                <button type="button" class="btn btn-secondary btn-admin" onclick="resetAddForm()">
                                    <i class="fas fa-times me-2"></i>Cancelar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Edit Content Tab -->
                <div class="tab-pane fade" id="tabEdit">
                    <div class="form-container">
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <label class="form-label">Filtrar por Página</label>
                                <select class="form-select" id="filterPageEdit" onchange="filterContentsEdit()">
                                    <option value="">Todas as Páginas</option>
                                    <option value="home">HOME</option>
                                    <option value="filmes">FILMES</option>
                                    <option value="series">SÉRIES</option>
                                    <option value="tv">TV AO VIVO</option>
                                    <option value="epg">EPG</option>
                                </select>
                            </div>
                            <div class="col-md-8">
                                <label class="form-label">Buscar</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="searchContent" 
                                           placeholder="Buscar conteúdo por título...">
                                    <button class="btn btn-primary-admin" type="button" onclick="searchContents()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table class="admin-table" id="contentsTable">
                                <thead>
                                    <tr>
                                        <th>Título</th>
                                        <th>Página</th>
                                        <th>Categoria</th>
                                        <th>Data</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="contentsTableBody">
                                    <!-- Content rows will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- View All Tab -->
                <div class="tab-pane fade" id="tabView">
                    <div class="form-container">
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label class="form-label">Filtrar por Página</label>
                                <select class="form-select" id="filterPageView" onchange="filterContentsView()">
                                    <option value="">Todas Páginas</option>
                                    <option value="home">HOME</option>
                                    <option value="filmes">FILMES</option>
                                    <option value="series">SÉRIES</option>
                                    <option value="tv">TV AO VIVO</option>
                                    <option value="epg">EPG</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Filtrar por Categoria</label>
                                <select class="form-select" id="filterCategoryView" onchange="filterContentsView()">
                                    <option value="">Todas Categorias</option>
                                    <!-- Categorias serão preenchidas dinamicamente -->
                                </select>
                            </div>
                        </div>
                        
                        <div class="row" id="contentsGrid">
                            <!-- Content cards will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <!-- Temporary Categories Tab -->
                <div class="tab-pane fade" id="tabTemp">
                    <div class="form-container">
                        <h4 class="mb-3"><i class="fas fa-clock me-2"></i>Gerenciar Categorias Temporárias</h4>
                        
                        <div class="table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Página</th>
                                        <th>Início</th>
                                        <th>Fim</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tempCategoriesTable">
                                    <!-- Temporary categories will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-primary-admin btn-admin" onclick="createTempCategoryModal()">
                                <i class="fas fa-plus me-2"></i>Nova Categoria Temp
                            </button>
                            <button class="btn btn-warning-admin btn-admin" onclick="checkTempCategories()">
                                <i class="fas fa-sync me-2"></i>Verificar Agora
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- GitHub Section -->
        <section id="githubSection" class="admin-section" style="display: none;">
            <h2 class="mb-4"><i class="fab fa-github me-2"></i>Sincronização GitHub</h2>
            
            <div class="github-section">
                <div class="mb-4">
                    <label class="form-label">Token de Acesso do GitHub</label>
                    <div class="input-group">
                        <input type="password" class="form-control github-token-input" id="githubToken" 
                               placeholder="Digite seu token do GitHub (ex: ghp_xxxxxxxxxxxxx)">
                        <button class="btn btn-outline-light edit-icon-btn" type="button" onclick="toggleTokenVisibility()">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-outline-light edit-icon-btn" type="button" onclick="editGitHubToken()">
                            <i class="fas fa-pencil-alt"></i>
                        </button>
                    </div>
                    <div class="form-text">
                        <i class="fas fa-info-circle me-2"></i>Para criar um token: Settings → Developer settings → Personal access tokens → Generate new token (selecione "repo" e "workflow")
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="form-label">Repositório GitHub</label>
                    <input type="text" class="form-control" id="githubRepo" value="Fu6rfho5zf/FlixTv4k" readonly>
                    <div class="form-text">Repositório onde os arquivos RSS serão enviados</div>
                </div>
                
                <div class="alert alert-admin">
                    <h5><i class="fas fa-exclamation-triangle me-2"></i>Atenção!</h5>
                    <p>Ao enviar os arquivos, você está atualizando o conteúdo para TODOS os usuários do aplicativo. Certifique-se de que os dados estão corretos.</p>
                </div>
                
                <div class="d-flex flex-wrap gap-2 mb-4">
                    <button class="btn btn-github btn-admin" onclick="sendToGithub('all')">
                        <i class="fas fa-paper-plane me-2"></i>ENVIAR ALL
                    </button>
                    <button class="btn btn-github btn-admin" onclick="sendToGithub('home')">
                        <i class="fas fa-home me-2"></i>ENVIAR HOME
                    </button>
                    <button class="btn btn-github btn-admin" onclick="sendToGithub('tv')">
                        <i class="fas fa-tv me-2"></i>ENVIAR TV
                    </button>
                    <button class="btn btn-github btn-admin" onclick="sendToGithub('filmes')">
                        <i class="fas fa-film me-2"></i>ENVIAR FILMES
                    </button>
                    <button class="btn btn-github btn-admin" onclick="sendToGithub('series')">
                        <i class="fas fa-list me-2"></i>ENVIAR SÉRIES
                    </button>
                    <button class="btn btn-github btn-admin" onclick="sendToGithub('epg')">
                        <i class="fas fa-tv me-2"></i>ENVIAR EPG
                    </button>
                    <button class="btn btn-github btn-admin" onclick="sendToGithub('login')">
                        <i class="fas fa-sign-in-alt me-2"></i>ENVIAR LOGINS
                    </button>
                </div>
                
                <div id="githubStatus"></div>
            </div>
            
            <div class="form-container mt-4">
                <h4 class="mb-3"><i class="fas fa-history me-2"></i>Histórico de Sincronizações</h4>
                <div class="table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Data/Hora</th>
                                <th>Arquivo</th>
                                <th>Status</th>
                                <th>Admin</th>
                            </tr>
                        </thead>
                        <tbody id="syncHistory">
                            <!-- Sync history will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Users Section -->
        <section id="usersSection" class="admin-section" style="display: none;">
            <h2 class="mb-4"><i class="fas fa-users me-2"></i>Gerenciar Usuários</h2>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="form-container">
                        <h4 class="mb-3"><i class="fas fa-user-plus me-2"></i>Criar Novo Usuário</h4>
                        <form id="createUserForm">
                            <div class="mb-3">
                                <label class="form-label">Nome do Usuário</label>
                                <input type="text" class="form-control" id="userName" placeholder="Nome completo" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Senha</label>
                                <input type="password" class="form-control" id="userPassword" placeholder="Senha forte" required>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" id="userEmail" placeholder="email@exemplo.com">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Telefone</label>
                                        <input type="tel" class="form-control" id="userPhone" placeholder="(11) 99999-9999">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Data de Criação</label>
                                        <input type="date" class="form-control" id="userCreateDate" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Data de Renovação</label>
                                        <input type="date" class="form-control" id="userRenewDate" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Plano</label>
                                <select class="form-select" id="userPlan" required>
                                    <option value="">Selecione um plano</option>
                                    <option value="VIP BRONZE">BRONZE</option>
                                    <option value="VIP PRATA">PRATA</option>
                                    <option value="VIP OURO">OURO</option>
                                    <option value="VIP PLATINA">PLATINA</option>
                                    <option value="VIP DIAMANTE">DIAMANTE</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Cargo</label>
                                <select class="form-select" id="userRole" required>
                                    <option value="user">Usuário</option>
                                    <option value="admin">Administrador</option>
                                    <option value="moderator">Moderador</option>
                                    <option value="vip">VIP</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Servidores RSS</label>
                                <div id="rssServersContainer">
                                    <div class="input-group mb-2">
                                        <input type="text" class="form-control rss-server" 
                                               value="https://raw.githubusercontent.com/Fu6rfho5zf/FlixTv4k/refs/heads/main/FlixHome.rss">                                
                                        <button class="btn btn-danger" type="button" onclick="removeRssServer(this)">×</button>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-sm btn-primary-admin mt-2" onclick="addRssServer()">
                                    <i class="fas fa-plus"></i> Adicionar Servidor
                                </button>
                            </div>
                            
                            <div class="mt-4">
                                <button type="submit" class="btn btn-success-admin btn-admin">
                                    <i class="fas fa-user-plus me-2"></i>Criar Usuário
                                </button>
                                <button type="button" class="btn btn-secondary btn-admin" onclick="resetUserForm()">
                                    <i class="fas fa-times me-2"></i>Cancelar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="form-container">
                        <h4 class="mb-3"><i class="fas fa-list me-2"></i>Lista de Usuários</h4>
                        <div class="table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Usuário</th>
                                        <th>Plano</th>
                                        <th>Cargo</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- Users will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Codes Section -->
        <section id="codesSection" class="admin-section" style="display: none;">
            <h2 class="mb-4"><i class="fas fa-gift me-2"></i>Gerar Códigos Temporários</h2>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="form-container">
                        <h4 class="mb-3"><i class="fas fa-plus-circle me-2"></i>Gerar Novo Código</h4>
                        <form id="generateCodeForm">
                            <div class="mb-3">
                                <label class="form-label">Quantidade de Códigos</label>
                                <input type="number" class="form-control" id="codeQuantity" min="1" max="100" value="1" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Usos por Código</label>
                                <input type="number" class="form-control" id="codeUses" min="1" max="1000" value="1" required>
                                <div class="form-text">Quantas pessoas podem resgatar cada código</div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Plano do Código</label>
                                <select class="form-select" id="codePlan" required>
                                    <option value="10_vip_com_ads">10 VIP COM ANÚNCIO</option>
                                    <option value="30_sem_ads">30 SEM ANÚNCIO</option>
                                    <option value="bronze">BRONZE</option>
                                    <option value="ouro">OURO</option>
                                    <option value="platina">PLATINA</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Data de Expiração</label>
                                <input type="date" class="form-control" id="codeExpiry" required>
                            </div>
                            
                            <div class="mt-4">
                                <button type="submit" class="btn btn-success-admin btn-admin">
                                    <i class="fas fa-gift me-2"></i>Gerar Códigos
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="form-container">
                        <h4 class="mb-3"><i class="fas fa-history me-2"></i>Códigos Gerados</h4>
                        <div class="table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Usos</th>
                                        <th>Expira</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="codesTableBody">
                                    <!-- Codes will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-container mt-4">
                <h4 class="mb-3"><i class="fas fa-code me-2"></i>Últimos Códigos Gerados</h4>
                <div class="code-generator">
                    <div id="generatedCodesList">
                        <!-- Generated codes will appear here -->
                    </div>
                    <button class="btn btn-primary-admin btn-admin" onclick="copyAllCodes()">
                        <i class="fas fa-copy me-2"></i>Copiar Todos os Códigos
                    </button>
                    <button class="btn btn-danger-admin btn-admin" onclick="clearAllCodes()">
                        <i class="fas fa-trash me-2"></i>Apagar Todos os Códigos
                    </button>
                </div>
            </div>
        </section>

        <!-- Import IPTV Section -->
        <section id="importSection" class="admin-section" style="display: none;">
            <h2 class="mb-4"><i class="fas fa-file-import me-2"></i>Importar Conteúdo IPTV</h2>
            
            <div class="iptv-section">
                <h4 class="mb-3"><i class="fas fa-satellite-dish me-2"></i>Importar Lista M3U</h4>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-container">
                            <h5 class="mb-3">Importar por URL</h5>
                            <form id="importM3UUrlForm">
                                <div class="mb-3">
                                    <label class="form-label">URL da Lista M3U</label>
                                    <input type="url" class="form-control" id="importM3UUrl" 
                                           placeholder="https://exemplo.com/lista.m3u" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Tipo de Conteúdo</label>
                                    <select class="form-select" id="importM3UType" required>
                                        <option value="tv">TV AO VIVO</option>
                                        <option value="filmes">FILMES</option>
                                        <option value="series">SÉRIES</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Detectar Categorias Automaticamente</label>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="autoDetectCategories" checked>
                                        <label class="form-check-label" for="autoDetectCategories">Ativar detecção automática</label>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <button type="submit" class="btn btn-primary-admin btn-admin">
                                        <i class="fas fa-download me-2"></i>Importar Lista
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-container">
                            <h5 class="mb-3">Upload de Arquivo M3U</h5>
                            <div class="mb-3">
                                <label class="form-label">Selecionar Arquivo M3U</label>
                                <input type="file" class="form-control" id="importM3UFile" accept=".m3u,.m3u8">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Tipo de Conteúdo</label>
                                <select class="form-select" id="uploadM3UType" required>
                                    <option value="tv">TV AO VIVO</option>
                                    <option value="filmes">FILMES</option>
                                    <option value="series">SÉRIES</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Detectar Categorias Automaticamente</label>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="autoDetectCategoriesUpload" checked>
                                    <label class="form-check-label" for="autoDetectCategoriesUpload">Ativar detecção automática</label>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <button class="btn btn-primary-admin btn-admin" onclick="uploadM3UFile()">
                                    <i class="fas fa-upload me-2"></i>Upload e Processar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Botão Carregar JSON (NOVO) -->
            <div class="form-container mt-4">
                <h4 class="mb-3"><i class="fas fa-file-code me-2"></i>Carregar Arquivos JSON</h4>
                <div class="alert alert-admin">
                    <i class="fas fa-info-circle me-2"></i>
                    Carregue arquivos JSON de canais, filmes e séries em formato estruturado
                </div>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="mb-3">
                            <label class="form-label">Selecionar Arquivos JSON (até 50 arquivos)</label>
                            <input type="file" class="form-control" id="jsonFiles" multiple accept=".json" onchange="previewJsonFiles()">
                            <div class="form-text">Selecione múltiplos arquivos JSON para carregar simultaneamente</div>
                        </div>
                        
                        <div class="json-file-list" id="jsonFileList">
                            <!-- Lista de arquivos selecionados será exibida aqui -->
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="d-grid gap-2">
                            <button class="btn btn-load-json btn-admin" onclick="openJsonModal()">
                                <i class="fas fa-eye me-2"></i>Visualizar e Processar
                            </button>
                            <button class="btn btn-primary-admin btn-admin" onclick="processJsonFiles()">
                                <i class="fas fa-upload me-2"></i>Processar Todos
                            </button>
                            <button class="btn btn-secondary btn-admin" onclick="clearJsonFiles()">
                                <i class="fas fa-times me-2"></i>Limpar Seleção
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Detected Categories -->
            <div class="form-container mt-4" id="detectedCategoriesSection" style="display: none;">
                <h4 class="mb-3"><i class="fas fa-folder me-2"></i>Categorias Detectadas</h4>
                <div id="detectedCategories" class="categories-grid">
                    <!-- Categorias detectadas serão exibidas aqui -->
                </div>
            </div>
            
            <!-- Imported Content -->
            <div class="form-container mt-4">
                <h4 class="mb-3"><i class="fas fa-list-alt me-2"></i>Conteúdo Importado</h4>
                
                <!-- Filtros por Categoria -->
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">Filtrar por Categoria</label>
                        <select class="form-select" id="filterImportedCategory" onchange="filterImportedContent()">
                            <option value="">Todas Categorias</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Tipo de Conteúdo</label>
                        <select class="form-select" id="filterImportedType" onchange="filterImportedContent()">
                            <option value="">Todos Tipos</option>
                            <option value="tv">TV AO VIVO</option>
                            <option value="filmes">FILMES</option>
                            <option value="series">SÉRIES</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Título</th>
                                <th>Logo</th>
                                <th>URL</th>
                                <th>Tipo</th>
                                <th>Categoria</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="importedContentTable">
                            <!-- Imported content will be loaded here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-3">
                    <button class="btn btn-success-admin btn-admin" onclick="saveAllImported()">
                        <i class="fas fa-save me-2"></i>Salvar Todos os Itens
                    </button>
                    <button class="btn btn-secondary btn-admin" onclick="clearImported()">
                        <i class="fas fa-times me-2"></i>Limpar Lista
                    </button>
                    <button class="btn btn-primary-admin btn-admin" onclick="sendImportedToGithub()">
                        <i class="fab fa-github me-2"></i>Enviar para GitHub
                    </button>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settingsSection" class="admin-section" style="display: none;">
            <h2 class="mb-4"><i class="fas fa-cog me-2"></i>Configurações</h2>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="form-container">
                        <h4 class="mb-3"><i class="fas fa-key me-2"></i>Configurações do Sistema</h4>
                        
                        <div class="mb-3">
                            <label class="form-label">TMDB API Key</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="tmdbApiKey" 
                                       placeholder="Digite sua chave da API TMDB">
                                <button class="btn btn-outline-light edit-icon-btn" type="button" onclick="toggleTMDBVisibility()">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-light edit-icon-btn" type="button" onclick="editTMDBKey()">
                                    <i class="fas fa-pencil-alt"></i>
                                </button>
                            </div>
                            <div class="form-text">Para obter dados detalhados dos filmes/séries</div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">GitHub Token</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="settingsGithubToken" 
                                       placeholder="Token do GitHub">
                                <button class="btn btn-outline-light edit-icon-btn" type="button" onclick="toggleSettingsTokenVisibility()">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-light edit-icon-btn" type="button" onclick="editSettingsToken()">
                                    <i class="fas fa-pencil-alt"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Tempo de Sessão (minutos)</label>
                            <input type="number" class="form-control" id="sessionTimeout" value="30" min="5" max="1440">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Máximo de Perfis por Usuário</label>
                            <input type="number" class="form-control" id="maxProfiles" value="6" min="1" max="10">
                        </div>
                        
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="enableRegistration" checked>
                            <label class="form-check-label" for="enableRegistration">Permitir registro de novos usuários</label>
                        </div>
                        
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="enableAutoSync" checked>
                            <label class="form-check-label" for="enableAutoSync">Sincronização automática com GitHub</label>
                        </div>
                        
                        <div class="mt-4">
                            <button class="btn btn-primary-admin btn-admin" onclick="saveSettings()">
                                <i class="fas fa-save me-2"></i>Salvar Configurações
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="form-container">
                        <h4 class="mb-3"><i class="fas fa-shield-alt me-2"></i>Segurança</h4>
                        
                        <div class="mb-3">
                            <label class="form-label">Alterar Senha Admin</label>
                            <input type="password" class="form-control" id="newAdminPassword" placeholder="Nova senha">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Confirmar Senha</label>
                            <input type="password" class="form-control" id="confirmAdminPassword" placeholder="Confirme a nova senha">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">IPs Permitidos (separados por vírgula)</label>
                            <textarea class="form-control" id="allowedIPs" rows="3" placeholder="192.168.1.1, 10.0.0.1"></textarea>
                            <div class="form-text">Deixe em branco para permitir todos os IPs</div>
                        </div>
                        
                        <div class="mt-4">
                            <button class="btn btn-warning-admin btn-admin" onclick="changeAdminPassword()">
                                <i class="fas fa-key me-2"></i>Alterar Senha
                            </button>
                            <button class="btn btn-danger-admin btn-admin" onclick="clearAllData()">
                                <i class="fas fa-trash me-2"></i>Limpar Todos os Dados
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-container mt-4">
                <h4 class="mb-3"><i class="fas fa-database me-2"></i>Backup e Restauração</h4>
                
                <div class="row">
                    <div class="col-md-6">
                        <button class="btn btn-primary-admin btn-admin w-100 mb-3" onclick="createBackup()">
                            <i class="fas fa-download me-2"></i>Criar Backup Completo
                        </button>
                    </div>
                    <div class="col-md-6">
                        <div class="input-group mb-3">
                            <input type="file" class="form-control" id="restoreFile" accept=".json">
                            <button class="btn btn-success-admin" type="button" onclick="restoreBackup()">
                                <i class="fas fa-upload me-2"></i>Restaurar
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="backupStatus"></div>
            </div>
            
            <!-- Configurações de Categorias Temporárias -->
            <div class="form-container mt-4">
                <h4 class="mb-3"><i class="fas fa-clock me-2"></i>Configurações de Categorias Temporárias</h4>
                
                <div class="mb-3">
                    <label class="form-label">Verificar automaticamente a cada (minutos)</label>
                    <input type="number" class="form-control" id="tempCategoryCheckInterval" value="5" min="1" max="60">
                </div>
                
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="enableTempCategories" checked>
                    <label class="form-check-label" for="enableTempCategories">Ativar categorias temporárias</label>
                </div>
                
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="archiveExpiredCategories" checked>
                    <label class="form-check-label" for="archiveExpiredCategories">Arquivar categorias expiradas</label>
                </div>
                
                <div class="mt-4">
                    <button class="btn btn-primary-admin btn-admin" onclick="saveTempCategorySettings()">
                        <i class="fas fa-save me-2"></i>Salvar Configurações
                    </button>
                </div>
            </div>
        </section>
    </div>

    <!-- Modals -->
    <div class="modal fade modal-admin" id="editContentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Conteúdo</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editContentForm">
                        <input type="hidden" id="editContentId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Título do Conteúdo</label>
                                    <input type="text" class="form-control" id="editContentTitle" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">URL do Logo/Poster</label>
                                    <input type="url" class="form-control" id="editContentPoster">
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">URL de Reprodução</label>
                                    <input type="url" class="form-control" id="editContentUrl" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Descrição</label>
                                    <textarea class="form-control" id="editContentDescription" rows="3"></textarea>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Página de Exibição</label>
                                    <select class="form-select" id="editContentPage" required onchange="updateEditCategories()">
                                        <option value="home">HOME</option>
                                        <option value="filmes">FILMES</option>
                                        <option value="series">SÉRIES</option>
                                        <option value="tv">TV AO VIVO</option>
                                        <option value="epg">EPG</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Categoria</label>
                                    <select class="form-select" id="editContentCategory" required>
                                        <!-- Categorias serão preenchidas dinamicamente -->
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Formato do Conteúdo</label>
                                    <select class="form-select" id="editContentFormat">
                                        <option value="m3u8">M3U8</option>
                                        <option value="mp4">MP4</option>
                                        <option value="ts">TS</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Ano de Lançamento</label>
                                    <input type="number" class="form-control" id="editContentYear">
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Gênero</label>
                                    <input type="text" class="form-control" id="editContentGenre">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Botões de ação para mover entre páginas -->
                        <div class="mb-3">
                            <label class="form-label">Mover para outra página/categoria</label>
                            <div class="d-flex gap-2">
                                <select class="form-select" id="moveContentPage">
                                    <option value="home">HOME</option>
                                    <option value="filmes">FILMES</option>
                                    <option value="series">SÉRIES</option>
                                    <option value="tv">TV AO VIVO</option>
                                    <option value="epg">EPG</option>
                                </select>
                                <select class="form-select" id="moveContentCategory">
                                    <option value="">Selecione categoria</option>
                                </select>
                                <button type="button" class="btn btn-warning-admin btn-admin" onclick="moveContentToPage()">
                                    <i class="fas fa-share"></i> Mover
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-admin" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary-admin btn-admin" onclick="saveEditedContent()">Salvar Alterações</button>
                    <button type="button" class="btn btn-danger-admin btn-admin" onclick="deleteContent()">Excluir Conteúdo</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade modal-admin" id="editUserModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Usuário</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editUserForm">
                        <input type="hidden" id="editUserId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Nome do Usuário</label>
                                    <input type="text" class="form-control" id="editUserName" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="editUserEmail">
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Telefone</label>
                                    <input type="tel" class="form-control" id="editUserPhone">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Data de Criação</label>
                                    <input type="date" class="form-control" id="editUserCreateDate" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Data de Renovação</label>
                                    <input type="date" class="form-control" id="editUserRenewDate" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Plano</label>
                                    <select class="form-select" id="editUserPlan" required>
                                        <option value="10_vip_com_ads">10 VIP COM ANÚNCIO</option>
                                        <option value="30_sem_ads">30 SEM ANÚNCIO</option>
                                        <option value="bronze">BRONZE</option>
                                        <option value="ouro">OURO</option>
                                        <option value="platina">PLATINA</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Cargo</label>
                                    <select class="form-select" id="editUserRole" required>
                                        <option value="user">Usuário</option>
                                        <option value="admin">Administrador</option>
                                        <option value="moderator">Moderador</option>
                                        <option value="vip">VIP</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-admin" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary-admin btn-admin" onclick="saveEditedUser()">Salvar Alterações</button>
                    <button type="button" class="btn btn-danger-admin btn-admin" onclick="deleteUser()">Excluir Usuário</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Criação de Nova Categoria -->
    <div class="modal fade modal-admin" id="newCategoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Criar Nova Categoria</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="newCategoryForm">
                        <div class="mb-3">
                            <label class="form-label">Nome da Categoria</label>
                            <input type="text" class="form-control" id="newCategoryName" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Página</label>
                            <select class="form-select" id="newCategoryPage" required>
                                <option value="home">HOME</option>
                                <option value="filmes">FILMES</option>
                                <option value="series">SÉRIES</option>
                                <option value="tv">TV AO VIVO</option>
                                <option value="epg">EPG</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="newCategoryIsTemp">
                                <label class="form-check-label" for="newCategoryIsTemp">Categoria Temporária</label>
                            </div>
                        </div>
                        
                        <div id="tempCategoryFields" style="display: none;">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Data de Início</label>
                                        <input type="date" class="form-control" id="newCategoryStartDate">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Hora de Início</label>
                                        <input type="time" class="form-control" id="newCategoryStartTime">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Duração (dias)</label>
                                <input type="number" class="form-control" id="newCategoryDuration" min="1" max="365" value="7">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-admin" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary-admin btn-admin" onclick="saveNewCategory()">Criar Categoria</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Carregar JSON (NOVO) -->
    <div class="modal fade modal-admin json-modal" id="jsonModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-file-code me-2"></i>Visualizar e Processar Arquivos JSON</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="json-tabs" id="jsonTabs">
                        <button class="json-tab active" onclick="switchJsonTab('canais')">
                            <i class="fas fa-tv me-2"></i>CANAIS
                        </button>
                        <button class="json-tab" onclick="switchJsonTab('filmes')">
                            <i class="fas fa-film me-2"></i>FILMES
                        </button>
                        <button class="json-tab" onclick="switchJsonTab('series')">
                            <i class="fas fa-list me-2"></i>SÉRIES
                        </button>
                    </div>
                    
                    <div class="json-content-container">
                        <div class="json-column" id="jsonCategoriasColumn">
                            <h5><i class="fas fa-folder me-2"></i>CATEGORIAS</h5>
                            <div id="jsonCategoriasList">
                                <!-- Categorias serão carregadas aqui -->
                            </div>
                        </div>
                        
                        <div class="json-column" id="jsonConteudosColumn">
                            <h5><i class="fas fa-list me-2"></i>CONTEÚDOS</h5>
                            <div id="jsonConteudosList">
                                <!-- Conteúdos serão carregados aqui -->
                            </div>
                        </div>
                        
                        <div class="json-preview" id="jsonPreviewColumn">
                            <h5><i class="fas fa-eye me-2"></i>PRÉVIA</h5>
                            <div id="jsonPreviewContent">
                                <div class="text-center py-5">
                                    <i class="fas fa-tv fa-3x mb-3 text-muted"></i>
                                    <p class="text-muted">Selecione um conteúdo para visualizar</p>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <h6><i class="fas fa-cog me-2"></i>Ações</h6>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary-admin" onclick="addSelectedJsonItem()">
                                        <i class="fas fa-plus me-2"></i>Adicionar Conteúdo
                                    </button>
                                    <button class="btn btn-success-admin" onclick="addAllJsonCategory()">
                                        <i class="fas fa-layer-group me-2"></i>Adicionar Categoria Inteira
                                    </button>
                                    <button class="btn btn-warning-admin" onclick="processAllJsonFiles()">
                                        <i class="fas fa-bolt me-2"></i>Processar Todos os Arquivos
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <div class="alert alert-admin">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Status:</strong> <span id="jsonStatus">Pronto para processar arquivos</span>
                            <br>
                            <small>Arquivos carregados: <span id="jsonFileCount">0</span> | Itens detectados: <span id="jsonItemCount">0</span></small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-admin" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary-admin btn-admin" onclick="saveAllJsonToSystem()">
                        <i class="fas fa-save me-2"></i>Salvar no Sistema
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ==============================================
        // CONFIGURAÇÃO DAS CATEGORIAS POR PÁGINA
        // ==============================================
        const CATEGORIES_BY_PAGE = {
            home: [
                "Destaques",
                "Em Alta",
                "Lançamentos",
                "Continuar Assistindo",
                "Recomendados",
                "Top 10 do Dia",
                "Novidades",
                "Adicionados Recentemente",
                "Mais Assistidos",
                "Tendências",
                "Popular Agora",
                "Para Você",
                "Assistidos Recentemente",
                "Minha Lista",
                "Favoritos",
                "Última Reprodução"
            ],
            filmes: {
                "Por gênero": [
                    "Ação", "Aventura", "Animação", "Anime", "Biografia",
                    "Comédia", "Comédia Romântica", "Crime", "Documentário",
                    "Drama", "Fantasia", "Família", "Ficção Científica",
                    "Guerra", "História", "Mistério", "Musical", "Romance",
                    "Suspense", "Terror", "Thriller", "Faroeste / Western"
                ],
                "Por público": [
                    "Infantil", "Juvenil", "Adulto (+18)", "Família", "Pré-adolescentes"
                ],
                "Por estilo": [
                    "Policial", "Catástrofe", "Super-heróis", "Baseado em fatos reais",
                    "Zumbi", "Apocalipse", "Sobrevivência", "Medieval",
                    "Espionagem", "Artes Marciais"
                ],
                "Por popularidade": [
                    "Top 10 Filmes", "Mais Assistidos", "Mais Avaliados",
                    "Oscar Winners", "Blockbusters"
                ],
                "Por ano ou época": [
                    "Lançamentos 2025", "Filmes 2020+", "Clássicos",
                    "Anos 80", "Anos 90", "Anos 2000"
                ]
            },
            series: {
                "Por gênero": [
                    "Ação", "Aventura", "Comédia", "Drama", "Romance",
                    "Suspense", "Terror", "Crime", "Policial",
                    "Ficção Científica", "Fantasia", "Reality Show",
                    "Documental", "Anime", "Sitcom", "Telenovela",
                    "Minissérie", "True Crime"
                ],
                "Por tipo": [
                    "Séries em Andamento", "Séries Finalizadas",
                    "Séries Originais", "Séries Populares",
                    "Top 10 Séries", "Recomendadas"
                ],
                "Por público": [
                    "Infantil", "Família", "Adulto (+18)"
                ],
                "Categorias usadas por Netflix / Prime / Disney": [
                    "Originais Netflix", "Originais Amazon", "Originais Disney+",
                    "Drama Coreano (K-Drama)", "Séries Japonesas", "Séries Chinesas",
                    "Séries Turcas", "Doramas", "Telenovelas"
                ]
            },
            tv: {
                "Canais de Filmes": [
                    "Filmes"
                ],
                "Canais de Séries": [
                    "Séries"
                ],
                "Canais de Notícias": [
                    "Notícias"
                ],
                "Canais Esportivos": [
                    "Esportes"
                ],
                "Canais Infantis": [
                    "Infantil", "Desenhos 24horas"
                ],
                "Canais Documentários": [
                    "Documentários"
                ],
                "Canais de Variedades": [
                    "Variedades"
                ],
                "Canais Abertos (Brasil)": [
                    "Aberta"
                ],
                "Canais Internacionais (IPTV padrão)": [
                    "Canais Internacionais"
                ],
                "Canais TELECINE & HBO (IPTV)": [
                    "HBO", "Telecine"
                ],
                "Religiosos": [
                    "Relógiosos"
                ],
                "Adulto (+18)": [
                    "adulto +18"
                ]
            },
            epg: {
                "Canais por tipo": [
                    "Geral", "Filmes", "Séries", "Notícias", "Esportes",
                    "Documentários", "Infantil", "Clima", "Música",
                    "Lifestyle", "Variedades", "Educação", "Culinária",
                    "Reality", "Tecnologia", "Religioso", "Compras",
                    "Regional", "Internacional"
                ],
                "Canais por idioma": [
                    "Português", "Inglês", "Espanhol", "Francês", "Italiano",
                    "Alemão", "Japonês", "Coreano", "Árabe", "Turco"
                ]
            }
        };

        // ==============================================
        // CONFIGURAÇÃO DOS FEEDS RSS
        // ==============================================
        const RSS_FEEDS = {
            home: 'https://raw.githubusercontent.com/Fu6rfho5zf/FlixTv4k/refs/heads/main/FlixHome.rss',
            tv: 'https://raw.githubusercontent.com/Fu6rfho5zf/FlixTv4k/refs/heads/main/FlixCanais.rss',
            filmes: 'https://raw.githubusercontent.com/Fu6rfho5zf/FlixTv4k/refs/heads/main/FlixFilmes.rss',
            series: 'https://raw.githubusercontent.com/Fu6rfho5zf/FlixTv4k/refs/heads/main/FlixSeries.rss',
            epg: 'https://raw.githubusercontent.com/Fu6rfho5zf/FlixTv4k/refs/heads/main/FlixEpg.rss',
            login: 'https://raw.githubusercontent.com/Fu6rfho5zf/FlixTv4k/refs/heads/main/FlixLogin.rss'
        };

        // ==============================================
        // CONFIGURAÇÃO INICIAL E VARIÁVEIS GLOBAIS
        // ==============================================
        const ADMIN_STORAGE_KEY = 'flixtv_admin_data';
        
        // CHAVE TMDB EMBUTIDA NO CÓDIGO
        const EMBEDDED_TMDB_API_KEY = '0dea6057249cfc73c2758f6166eb0d6f';
        
        let adminData = {
            contents: [],
            users: [],
            codes: [],
            syncHistory: [],
            imports: [],
            tempCategories: [],
            archivedCategories: [],
            settings: {
                tmdbApiKey: EMBEDDED_TMDB_API_KEY,
                githubToken: '',
                sessionTimeout: 30,
                maxProfiles: 6,
                enableRegistration: true,
                enableAutoSync: true,
                allowedIPs: '',
                tempCategoryCheckInterval: 5,
                enableTempCategories: true,
                archiveExpiredCategories: true
            },
            stats: {
                totalContents: 0,
                totalCategories: 0,
                totalUsers: 0,
                activeUsers: 0,
                totalCodes: 0,
                usedCodes: 0,
                lastSync: null,
                storageUsed: 0,
                lastActivity: new Date().toISOString(),
                tempCategoriesCount: 0
            }
        };
        
        let currentAdmin = null;
        let importedItems = [];
        let currentPage = 'home';
        let currentCategory = '';
        let detectedIPTVCategories = [];
        let currentIPTVChannels = [];
        let tempCategoryCheckInterval = null;
        
        // ==============================================
        // NOVAS VARIÁVEIS PARA FUNCIONALIDADE JSON
        // ==============================================
        let jsonFilesData = [];
        let jsonParsedData = {
            canais: [],
            filmes: [],
            series: []
        };
        let currentJsonTab = 'canais';
        let selectedJsonCategory = null;
        let selectedJsonItem = null;

        // ==============================================
        // FUNÇÕES DE INICIALIZAÇÃO
        // ==============================================
        function initAdminPanel() {
            loadAdminData();
            loadCurrentAdmin();
            setupEventListeners();
            updateDashboard();
            loadAllContents();
            loadAllUsers();
            loadAllCodes();
            loadSyncHistory();
            loadTempCategories();
            
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('userCreateDate').value = today;
            document.getElementById('userRenewDate').value = today;
            document.getElementById('tempCategoryStartDate').value = today;
            document.getElementById('tempCategoryStartTime').value = '00:00';
            
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            document.getElementById('codeExpiry').value = nextMonth.toISOString().split('T')[0];
            
            // Load categories for current page
            loadCategoriesForPage(currentPage);
            renderCategoriesGrid(currentPage);
            
            // Update preview
            updatePreview();
            
            // Close sidebar on mobile on load
            if (window.innerWidth <= 992) {
                document.getElementById('sidebar').classList.remove('active');
            }
            
            // Hide category content view initially
            document.getElementById('categoryContentView').style.display = 'none';
            document.getElementById('iptvEditFormContainer').style.display = 'none';
            
            // Load settings
            loadSettings();
            
            // Iniciar verificação automática de categorias temporárias
            startTempCategoryChecker();
            
            // Carregar dados de login em tempo real
            loadLoginData();
        }

        function loadAdminData() {
            const savedData = localStorage.getItem(ADMIN_STORAGE_KEY);
            if (savedData) {
                adminData = JSON.parse(savedData);
            } else {
                // Create default admin if none exists
                const defaultAdmin = {
                    id: 'admin_1',
                    username: 'daniel',
                    password: 'daniel',
                    email: 'admin@FLIX TV MAX.com',
                    role: 'superadmin',
                    created: new Date().toISOString()
                };
                
                adminData.users = [defaultAdmin];
                saveAdminData();
            }
        }

        function loadCurrentAdmin() {
            const savedAdmin = localStorage.getItem('current_admin');
            if (savedAdmin) {
                currentAdmin = JSON.parse(savedAdmin);
                document.getElementById('currentAdmin').textContent = currentAdmin.username;
            } else {
                // Show login modal (simplified for this example)
                const username = prompt('Nome de usuário admin:');
                const password = prompt('Senha admin:');
                
                const admin = adminData.users.find(u => 
                    u.username === username && u.password === password
                );
                
                if (admin) {
                    currentAdmin = admin;
                    localStorage.setItem('current_admin', JSON.stringify(currentAdmin));
                    document.getElementById('currentAdmin').textContent = currentAdmin.username;
                } else {
                    alert('Credenciais inválidas!');
                    window.location.href = 'WEB.html';
                }
            }
        }

        async function loadLoginData() {
            try {
                const response = await fetch(RSS_FEEDS.login);
                if (!response.ok) throw new Error('Erro ao carregar login');
                
                const text = await response.text();
                parseLoginRSS(text);
                
                console.log('Dados de login carregados em tempo real');
            } catch (error) {
                console.error('Erro ao carregar dados de login:', error);
            }
        }

        function parseLoginRSS(rssText) {
            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(rssText, "text/xml");
                const items = xmlDoc.querySelectorAll('item');
                
                // Limpar usuários existentes (exceto admin)
                const adminUsers = adminData.users.filter(u => u.role === 'superadmin');
                adminData.users = adminUsers;
                
                items.forEach(item => {
                    const username = item.querySelector('username')?.textContent;
                    const password = item.querySelector('password')?.textContent;
                    const subscription = item.querySelector('subscription')?.textContent;
                    const expiry = item.querySelector('expiry')?.textContent;
                    const cargo = item.querySelector('cargo')?.textContent;
                    
                    if (username && password) {
                        // Verificar se usuário já existe
                        const existingUser = adminData.users.find(u => u.username === username);
                        if (!existingUser) {
                            const user = {
                                id: 'user_' + Date.now() + '_' + Math.random(),
                                username: username,
                                password: password,
                                email: '',
                                phone: '',
                                createDate: new Date().toISOString().split('T')[0],
                                renewDate: expiry || new Date().toISOString().split('T')[0],
                                plan: subscription || 'VIP BRONZE',
                                role: cargo || 'user',
                                status: 'active',
                                createdBy: 'RSS Feed',
                                created: new Date().toISOString()
                            };
                            
                            adminData.users.push(user);
                        }
                    }
                });
                
                saveAdminData();
                loadAllUsers();
                updateDashboard();
                
            } catch (error) {
                console.error('Erro ao analisar RSS de login:', error);
            }
        }

        function saveAdminData() {
            localStorage.setItem(ADMIN_STORAGE_KEY, JSON.stringify(adminData));
        }

        function loadSettings() {
            // TMDB API Key está embutida no código
            document.getElementById('tmdbApiKey').value = EMBEDDED_TMDB_API_KEY;
            
            // Load GitHub Token
            if (adminData.settings.githubToken) {
                document.getElementById('githubToken').value = adminData.settings.githubToken;
                document.getElementById('settingsGithubToken').value = adminData.settings.githubToken;
            }
            
            // Load other settings
            document.getElementById('sessionTimeout').value = adminData.settings.sessionTimeout;
            document.getElementById('maxProfiles').value = adminData.settings.maxProfiles;
            document.getElementById('enableRegistration').checked = adminData.settings.enableRegistration;
            document.getElementById('enableAutoSync').checked = adminData.settings.enableAutoSync;
            document.getElementById('allowedIPs').value = adminData.settings.allowedIPs || '';
            
            // Temp category settings
            document.getElementById('tempCategoryCheckInterval').value = adminData.settings.tempCategoryCheckInterval;
            document.getElementById('enableTempCategories').checked = adminData.settings.enableTempCategories;
            document.getElementById('archiveExpiredCategories').checked = adminData.settings.archiveExpiredCategories;
        }

        // ==============================================
        // FUNÇÕES DE NAVEGAÇÃO E SIDEBAR
        // ==============================================
        function setupEventListeners() {
            // Toggle sidebar for mobile
            document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);
            
            // Toggle pages menu
            document.getElementById('pagesTitle').addEventListener('click', () => {
                toggleCollapse('pagesTitle', 'pageList');
            });
            
            // Toggle categories menu
            document.getElementById('categoriesTitle').addEventListener('click', () => {
                toggleCollapse('categoriesTitle', 'categoryList');
            });
            
            // Page navigation
            document.querySelectorAll('.page-item[data-page]').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = item.dataset.page;
                    changePage(page);
                });
            });
            
            // Section navigation
            document.querySelectorAll('.page-item[data-section]').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = item.dataset.section;
                    switchSection(section);
                });
            });
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('current_admin');
                window.location.href = 'WEB.html';
            });
            
            // Format buttons
            document.querySelectorAll('.format-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.format-btn').forEach(b => {
                        b.classList.remove('btn-primary-admin');
                        b.classList.add('btn-outline-light');
                    });
                    btn.classList.remove('btn-outline-light');
                    btn.classList.add('btn-primary-admin');
                    document.getElementById('contentFormat').value = btn.dataset.format;
                });
            });
            
            // Content form preview
            document.getElementById('contentTitle').addEventListener('input', updatePreview);
            document.getElementById('contentPoster').addEventListener('input', updatePreview);
            document.getElementById('contentPage').addEventListener('change', updatePreview);
            document.getElementById('contentCategory').addEventListener('change', updatePreview);
            
            // Add content form
            document.getElementById('addContentForm').addEventListener('submit', addContent);
            
            // IPTV Edit form
            document.getElementById('iptvEditForm').addEventListener('submit', saveIPTVContent);
            
            // Generate code form
            document.getElementById('generateCodeForm').addEventListener('submit', generateCodes);
            
            // Create user form
            document.getElementById('createUserForm').addEventListener('submit', createUser);
            
            // Import M3U URL form
            document.getElementById('importM3UUrlForm').addEventListener('submit', importM3UFromUrl);
            
            // Filter page change
            document.getElementById('filterPage').addEventListener('change', function() {
                changePage(this.value);
            });
            
            // Temp category form
            document.getElementById('tempCategoryForm').addEventListener('submit', createTempCategory);
            
            // Checkbox para categoria temporária
            document.getElementById('newCategoryIsTemp').addEventListener('change', function() {
                document.getElementById('tempCategoryFields').style.display = 
                    this.checked ? 'block' : 'none';
            });
            
            // Bootstrap tab handling
            const tabEls = document.querySelectorAll('a[data-bs-toggle="tab"]');
            tabEls.forEach(tabEl => {
                tabEl.addEventListener('shown.bs.tab', function(event) {
                    if (event.target.getAttribute('href') === '#tabView') {
                        renderContentsGrid();
                    } else if (event.target.getAttribute('href') === '#tabTemp') {
                        loadTempCategoriesTable();
                    }
                });
            });
            
            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(event) {
                const sidebar = document.getElementById('sidebar');
                const toggleBtn = document.getElementById('sidebarToggle');
                
                if (window.innerWidth <= 992 && 
                    sidebar.classList.contains('active') &&
                    !sidebar.contains(event.target) && 
                    !toggleBtn.contains(event.target)) {
                    sidebar.classList.remove('active');
                }
            });
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
            
            // Change icon
            const icon = document.querySelector('#sidebarToggle i');
            if (sidebar.classList.contains('active')) {
                icon.className = 'fas fa-times';
            } else {
                icon.className = 'fas fa-bars';
            }
        }

        function toggleCollapse(titleId, contentId) {
            const title = document.getElementById(titleId);
            const content = document.getElementById(contentId);
            
            title.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
        }

        function changePage(page = null) {
            if (!page) {
                page = document.getElementById('filterPage').value;
            }
            
            currentPage = page;
            
            // Update active page in sidebar
            document.querySelectorAll('.page-item[data-page]').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });
            
            // Update filter dropdown
            document.getElementById('filterPage').value = page;
            
            // Load categories for this page
            loadCategoriesForPage(page);
            renderCategoriesGrid(page);
            
            // Clear selected category
            currentCategory = '';
            document.getElementById('categoryContentView').style.display = 'none';
            
            // Update UI
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('active');
            });
            
            updateDashboard();
            
            // Close sidebar on mobile
            if (window.innerWidth <= 992) {
                document.getElementById('sidebar').classList.remove('active');
                document.querySelector('#sidebarToggle i').className = 'fas fa-bars';
            }
        }

        function selectCategory(category) {
            currentCategory = category;
            
            // Update UI
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('active');
                if (card.dataset.category === category) {
                    card.classList.add('active');
                }
            });
            
            // Update sidebar category list
            document.querySelectorAll('.category-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.category === category) {
                    item.classList.add('active');
                }
            });
            
            // Show category content view
            document.getElementById('categoryContentView').style.display = 'block';
            document.getElementById('currentCategoryName').textContent = category;
            
            // Load contents for this category
            loadCategoryContents();
            
            // Close sidebar on mobile
            if (window.innerWidth <= 992) {
                document.getElementById('sidebar').classList.remove('active');
                document.querySelector('#sidebarToggle i').className = 'fas fa-bars';
            }
        }

        function switchSection(section) {
            // Hide all sections
            document.querySelectorAll('.admin-section').forEach(el => {
                el.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(section + 'Section').style.display = 'block';
            
            // Update active menu in sidebar
            document.querySelectorAll('.page-item[data-section]').forEach(el => {
                el.classList.remove('active');
            });
            
            const sectionItem = document.querySelector(`.page-item[data-section="${section}"]`);
            if (sectionItem) {
                sectionItem.classList.add('active');
            }
            
            // Update dashboard stats
            updateDashboard();
            
            // Close sidebar on mobile
            if (window.innerWidth <= 992) {
                document.getElementById('sidebar').classList.remove('active');
                document.querySelector('#sidebarToggle i').className = 'fas fa-bars';
            }
        }

        // ==============================================
        // FUNÇÕES DE CATEGORIAS
        // ==============================================
        function loadCategoriesForPage(page) {
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = '';
            
            let categories = [];
            const pageData = CATEGORIES_BY_PAGE[page];
            
            if (Array.isArray(pageData)) {
                // For HOME page (simple array)
                categories = pageData;
                categories.forEach(category => {
                    addCategoryItem(category, categoryList);
                });
            } else if (typeof pageData === 'object') {
                // For other pages (nested categories)
                for (const [group, groupCategories] of Object.entries(pageData)) {
                    // Add group header
                    const groupHeader = document.createElement('div');
                    groupHeader.className = 'category-group';
                    groupHeader.style.padding = '12px 18px';
                    groupHeader.style.color = 'var(--text-gray)';
                    groupHeader.style.fontSize = '12px';
                    groupHeader.style.textTransform = 'uppercase';
                    groupHeader.style.fontWeight = '700';
                    groupHeader.textContent = group;
                    categoryList.appendChild(groupHeader);
                    
                    // Add categories in group
                    groupCategories.forEach(category => {
                        addCategoryItem(category, categoryList);
                    });
                }
            }
            
            // Adicionar categorias temporárias ativas
            const activeTempCategories = adminData.tempCategories.filter(cat => 
                cat.page === page && cat.status === 'active'
            );
            
            if (activeTempCategories.length > 0) {
                const tempHeader = document.createElement('div');
                tempHeader.className = 'category-group';
                tempHeader.style.padding = '12px 18px';
                tempHeader.style.color = 'var(--warning-color)';
                tempHeader.style.fontSize = '12px';
                tempHeader.style.textTransform = 'uppercase';
                tempHeader.style.fontWeight = '700';
                tempHeader.textContent = 'Temporárias';
                categoryList.appendChild(tempHeader);
                
                activeTempCategories.forEach(tempCat => {
                    addCategoryItem(tempCat.name + ' ⏰', categoryList);
                });
            }
        }

        function addCategoryItem(category, container) {
            const item = document.createElement('a');
            item.className = 'category-item';
            item.dataset.category = category.replace(' ⏰', '');
            item.innerHTML = `
                <div class="category-icon"><i class="fas fa-folder"></i></div>
                <div class="category-text">${category}</div>
            `;
            item.addEventListener('click', () => {
                selectCategory(category.replace(' ⏰', ''));
            });
            container.appendChild(item);
        }

        function renderCategoriesGrid(page) {
            const grid = document.getElementById('categoriesGrid');
            grid.innerHTML = '';
            
            let categories = [];
            const pageData = CATEGORIES_BY_PAGE[page];
            
            if (Array.isArray(pageData)) {
                // For HOME page
                categories = pageData;
            } else if (typeof pageData === 'object') {
                // For other pages, flatten all categories
                for (const groupCategories of Object.values(pageData)) {
                    categories = categories.concat(groupCategories);
                }
            }
            
            // Adicionar categorias temporárias ativas
            const activeTempCategories = adminData.tempCategories.filter(cat => 
                cat.page === page && cat.status === 'active'
            );
            
            activeTempCategories.forEach(tempCat => {
                categories.push(tempCat.name + ' ⏰');
            });
            
            // Count contents per category
            const categoryCounts = {};
            categories.forEach(cat => {
                const cleanCat = cat.replace(' ⏰', '');
                categoryCounts[cleanCat] = adminData.contents.filter(c => 
                    c.page === page && c.category === cleanCat
                ).length;
            });
            
            // Sort by count (descending)
            categories.sort((a, b) => {
                const cleanA = a.replace(' ⏰', '');
                const cleanB = b.replace(' ⏰', '');
                return categoryCounts[cleanB] - categoryCounts[cleanA];
            });
            
            // Render category cards
            categories.forEach(category => {
                const cleanCategory = category.replace(' ⏰', '');
                const count = categoryCounts[cleanCategory] || 0;
                const isTemp = category.includes('⏰');
                
                const card = document.createElement('div');
                card.className = 'category-card';
                card.dataset.category = cleanCategory;
                card.innerHTML = `
                    <div class="category-card-icon">
                        <i class="fas fa-${getCategoryIcon(cleanCategory)}"></i>
                    </div>
                    <div class="category-card-title">${cleanCategory} 
                        ${isTemp ? '<span class="temp-category-badge">TEMP</span>' : ''}
                    </div>
                    <div class="category-card-count">${count} conteúdo(s)</div>
                `;
                card.addEventListener('click', () => {
                    selectCategory(cleanCategory);
                });
                grid.appendChild(card);
            });
            
            // Update total categories count
            adminData.stats.totalCategories = categories.length;
            adminData.stats.tempCategoriesCount = activeTempCategories.length;
            document.getElementById('totalCategories').textContent = categories.length;
            document.getElementById('tempCategoriesCount').textContent = activeTempCategories.length;
        }

        function getCategoryIcon(category) {
            // Map categories to icons
            const iconMap = {
                // Common icons
                'Destaques': 'star',
                'Em Alta': 'fire',
                'Lançamentos': 'rocket',
                'Recomendados': 'thumbs-up',
                'Top 10': 'trophy',
                'Mais Assistidos': 'eye',
                'Tendências': 'chart-line',
                'Favoritos': 'heart',
                'Ação': 'bolt',
                'Comédia': 'laugh',
                'Drama': 'theater-masks',
                'Terror': 'ghost',
                'Romance': 'heart',
                'Ficção Científica': 'robot',
                'Documentário': 'file-alt',
                'Animação': 'film',
                'Infantil': 'child',
                'Família': 'home',
                'Esportes': 'futbol',
                'Notícias': 'newspaper',
                'Música': 'music',
                'Filmes': 'film',
                'Séries': 'tv',
                'TV': 'satellite-dish',
                'EPG': 'tv',
                'Adulto': 'exclamation-triangle'
            };
            
            // Find matching icon
            for (const [key, icon] of Object.entries(iconMap)) {
                if (category.toLowerCase().includes(key.toLowerCase())) {
                    return icon;
                }
            }
            
            // Default icon
            return 'folder';
        }

        function updateCategoriesByPage() {
            const page = document.getElementById('contentPage').value;
            const categorySelect = document.getElementById('contentCategory');
            categorySelect.innerHTML = '<option value="">Selecione uma categoria</option>';
            
            if (!page) return;
            
            let categories = [];
            const pageData = CATEGORIES_BY_PAGE[page];
            
            if (Array.isArray(pageData)) {
                // For HOME page
                categories = pageData;
            } else if (typeof pageData === 'object') {
                // For other pages, flatten all categories
                for (const groupCategories of Object.values(pageData)) {
                    categories = categories.concat(groupCategories);
                }
            }
            
            // Adicionar categorias temporárias ativas
            const activeTempCategories = adminData.tempCategories.filter(cat => 
                cat.page === page && cat.status === 'active'
            );
            
            activeTempCategories.forEach(tempCat => {
                categories.push(tempCat.name + ' ⏰');
            });
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.replace(' ⏰', '');
                option.textContent = category;
                categorySelect.appendChild(option);
            });
            
            updatePreview();
        }

        function updateIPTVCategories() {
            const page = document.getElementById('iptvEditPage').value;
            const categorySelect = document.getElementById('iptvEditCategory');
            categorySelect.innerHTML = '<option value="">Selecione uma categoria</option>';
            
            if (!page) return;
            
            let categories = [];
            const pageData = CATEGORIES_BY_PAGE[page];
            
            if (Array.isArray(pageData)) {
                // For HOME page
                categories = pageData;
            } else if (typeof pageData === 'object') {
                // For other pages, flatten all categories
                for (const groupCategories of Object.values(pageData)) {
                    categories = categories.concat(groupCategories);
                }
            }
            
            // Adicionar categorias temporárias ativas
            const activeTempCategories = adminData.tempCategories.filter(cat => 
                cat.page === page && cat.status === 'active'
            );
            
            activeTempCategories.forEach(tempCat => {
                categories.push(tempCat.name + ' ⏰');
            });
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.replace(' ⏰', '');
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }

        function updateEditCategories() {
            const page = document.getElementById('editContentPage').value;
            const categorySelect = document.getElementById('editContentCategory');
            categorySelect.innerHTML = '<option value="">Selecione uma categoria</option>';
            
            if (!page) return;
            
            let categories = [];
            const pageData = CATEGORIES_BY_PAGE[page];
            
            if (Array.isArray(pageData)) {
                // For HOME page
                categories = pageData;
            } else if (typeof pageData === 'object') {
                // For other pages, flatten all categories
                for (const groupCategories of Object.values(pageData)) {
                    categories = categories.concat(groupCategories);
                }
            }
            
            // Adicionar categorias temporárias ativas
            const activeTempCategories = adminData.tempCategories.filter(cat => 
                cat.page === page && cat.status === 'active'
            );
            
            activeTempCategories.forEach(tempCat => {
                categories.push(tempCat.name + ' ⏰');
            });
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.replace(' ⏰', '');
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }

        // ==============================================
        // FUNÇÕES DO DASHBOARD
        // ==============================================
        function updateDashboard() {
            // Update stats
            adminData.stats.totalContents = adminData.contents.length;
            adminData.stats.totalUsers = adminData.users.length;
            adminData.stats.activeUsers = adminData.users.filter(u => u.status !== 'inactive').length;
            adminData.stats.totalCodes = adminData.codes.length;
            adminData.stats.usedCodes = adminData.codes.filter(c => c.used >= c.maxUses).length;
            adminData.stats.tempCategoriesCount = adminData.tempCategories.filter(cat => 
                cat.status === 'active'
            ).length;
            
            // Update UI
            document.getElementById('totalContents').textContent = adminData.stats.totalContents;
            document.getElementById('totalCategories').textContent = adminData.stats.totalCategories;
            document.getElementById('totalUsers').textContent = adminData.stats.totalUsers;
            document.getElementById('activeUsers').textContent = adminData.stats.activeUsers;
            
            if (adminData.stats.lastSync) {
                document.getElementById('lastSync').textContent = 
                    new Date(adminData.stats.lastSync).toLocaleDateString();
                document.getElementById('syncStatus').textContent = 'Sincronizado';
            }
            
            // Calculate storage used
            const dataSize = JSON.stringify(adminData).length;
            const sizeInMB = (dataSize / (1024 * 1024)).toFixed(2);
            adminData.stats.storageUsed = sizeInMB;
            document.getElementById('storageUsed').textContent = sizeInMB + ' MB';
            
            // Update last activity
            adminData.stats.lastActivity = new Date().toLocaleString();
            document.getElementById('lastActivity').textContent = adminData.stats.lastActivity;
            document.getElementById('tempCategoriesCount').textContent = adminData.stats.tempCategoriesCount;
            
            saveAdminData();
        }

        function loadCategoryContents() {
            const tableBody = document.getElementById('categoryContentsTableBody');
            tableBody.innerHTML = '';
            
            const filtered = adminData.contents.filter(content => {
                return content.page === currentPage && content.category === currentCategory;
            });
            
            filtered.forEach(content => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${content.title}</td>
                    <td><span class="status-badge">${content.page.toUpperCase()}</span></td>
                    <td>${content.category}</td>
                    <td>${new Date(content.addedDate).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-sm btn-primary-admin me-1" onclick="openEditContent('${content.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger-admin" onclick="deleteContentById('${content.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function searchCategoryContent() {
            const searchTerm = document.getElementById('searchCategoryContent').value.toLowerCase();
            const tableBody = document.getElementById('categoryContentsTableBody');
            const rows = tableBody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 0) {
                    const title = cells[0].textContent.toLowerCase();
                    const show = title.includes(searchTerm);
                    row.style.display = show ? '' : 'none';
                }
            });
        }

        // ==============================================
        // FUNÇÕES IPTV POR CONTEÚDO INDIVIDUAL
        // ==============================================
        async function loadSingleIPTV() {
            const url = document.getElementById('iptvSingleUrl').value;
            const fileInput = document.getElementById('iptvSingleFile');
            const type = document.getElementById('iptvSingleType').value;
            
            let m3uContent = '';
            
            if (url) {
                showLoading('Carregando lista IPTV da URL...');
                try {
                    const response = await fetch(`https://corsproxy.io/?${encodeURIComponent(url)}`);
                    if (!response.ok) throw new Error('Erro ao carregar URL');
                    m3uContent = await response.text();
                } catch (error) {
                    hideLoading();
                    alert(`Erro ao carregar URL: ${error.message}`);
                    return;
                }
            } else if (fileInput.files.length > 0) {
                showLoading('Processando arquivo IPTV...');
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    m3uContent = e.target.result;
                    processSingleIPTV(m3uContent, type);
                };
                
                reader.onerror = function() {
                    hideLoading();
                    alert('Erro ao ler arquivo');
                };
                
                reader.readAsText(file);
                return;
            } else {
                alert('Por favor, forneça uma URL ou selecione um arquivo!');
                return;
            }
            
            processSingleIPTV(m3uContent, type);
        }

        function processSingleIPTV(m3uContent, type) {
            const lines = m3uContent.split('\n');
            currentIPTVChannels = [];
            let categories = new Set();
            
            let currentItem = null;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.startsWith('#EXTINF:')) {
                    currentItem = parseEXTINF(line, type);
                } else if (line && !line.startsWith('#') && currentItem) {
                    currentItem.url = line;
                    currentItem.id = 'iptv_' + Date.now() + '_' + currentIPTVChannels.length;
                    
                    currentIPTVChannels.push({...currentItem});
                    categories.add(currentItem.category);
                    currentItem = null;
                }
            }
            
            hideLoading();
            
            // Update category filter
            const categorySelect = document.getElementById('iptvFilterCategory');
            categorySelect.innerHTML = '<option value="">Todas Categorias</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
            
            // Render channels
            renderIPTVChannels();
            
            alert(`Carregados ${currentIPTVChannels.length} canais da lista IPTV!`);
        }

        function renderIPTVChannels() {
            const container = document.getElementById('iptvChannelsContainer');
            container.innerHTML = '';
            
            if (currentIPTVChannels.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-tv fa-3x mb-3 text-muted"></i>
                        <p class="text-muted">Nenhum canal carregado</p>
                    </div>
                `;
                return;
            }
            
            // Group by category
            const channelsByCategory = {};
            currentIPTVChannels.forEach(channel => {
                if (!channelsByCategory[channel.category]) {
                    channelsByCategory[channel.category] = [];
                }
                channelsByCategory[channel.category].push(channel);
            });
            
            // Render each category
            for (const [category, channels] of Object.entries(channelsByCategory)) {
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'd-flex justify-content-between align-items-center mb-2 mt-4';
                categoryHeader.innerHTML = `
                    <h6 class="mb-0"><i class="fas fa-folder me-2"></i>${category}</h6>
                    <span class="badge bg-primary">${channels.length} canais</span>
                `;
                container.appendChild(categoryHeader);
                
                channels.forEach(channel => {
                    const channelItem = document.createElement('div');
                    channelItem.className = 'channel-item';
                    channelItem.dataset.id = channel.id;
                    channelItem.innerHTML = `
                        <img src="${channel.poster || 'https://via.placeholder.com/40x40/333/666?text=TV'}" 
                             class="channel-logo" alt="${channel.title}">
                        <div class="channel-info">
                            <div class="channel-name">${channel.title}</div>
                            <div class="channel-url">${channel.url.substring(0, 80)}...</div>
                        </div>
                        <div class="iptv-channel-actions">
                            <button class="btn btn-sm btn-primary-admin" onclick="editIPTVChannel('${channel.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-success-admin" onclick="quickAddIPTVChannel('${channel.id}')">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    `;
                    container.appendChild(channelItem);
                });
            }
        }

        function filterIPTVChannels() {
            const searchTerm = document.getElementById('iptvSearchChannel').value.toLowerCase();
            const categoryFilter = document.getElementById('iptvFilterCategory').value;
            
            const container = document.getElementById('iptvChannelsContainer');
            const channelItems = container.querySelectorAll('.channel-item');
            
            channelItems.forEach(item => {
                const channelName = item.querySelector('.channel-name').textContent.toLowerCase();
                const channelCategory = item.closest('.channel-item')?.previousElementSibling?.querySelector('h6')?.textContent || '';
                
                let show = true;
                
                if (searchTerm && !channelName.includes(searchTerm)) {
                    show = false;
                }
                
                if (categoryFilter && channelCategory !== categoryFilter) {
                    show = false;
                }
                
                item.style.display = show ? 'flex' : 'none';
                
                // Hide category headers if all channels are hidden
                if (item.previousElementSibling && item.previousElementSibling.classList.contains('d-flex')) {
                    const categoryDiv = item.previousElementSibling;
                    const nextSibling = categoryDiv.nextElementSibling;
                    
                    // Check if any channel in this category is visible
                    let hasVisible = false;
                    let next = nextSibling;
                    while (next && !next.classList.contains('d-flex')) {
                        if (next.style.display !== 'none') {
                            hasVisible = true;
                            break;
                        }
                        next = next.nextElementSibling;
                    }
                    
                    categoryDiv.style.display = hasVisible ? 'flex' : 'none';
                }
            });
        }

        function editIPTVChannel(channelId) {
            const channel = currentIPTVChannels.find(c => c.id === channelId);
            if (!channel) return;
            
            document.getElementById('iptvEditFormContainer').style.display = 'block';
            document.getElementById('iptvEditId').value = channel.id;
            document.getElementById('iptvEditTitle').value = channel.title;
            document.getElementById('iptvEditLogo').value = channel.poster || '';
            document.getElementById('iptvEditUrl').value = channel.url;
            document.getElementById('iptvEditDescription').value = channel.description || '';
            document.getElementById('iptvEditPage').value = channel.page || 'tv';
            document.getElementById('iptvEditFormat').value = channel.format || 'm3u8';
            document.getElementById('iptvEditQuality').value = channel.quality || '';
            
            // Update categories for selected page
            updateIPTVCategories();
            
            // Set category after a short delay to ensure options are loaded
            setTimeout(() => {
                document.getElementById('iptvEditCategory').value = channel.category || 'Geral';
            }, 100);
            
            // Scroll to edit form
            document.getElementById('iptvEditFormContainer').scrollIntoView({ behavior: 'smooth' });
        }

        function quickAddIPTVChannel(channelId) {
            const channel = currentIPTVChannels.find(c => c.id === channelId);
            if (!channel) return;
            
            const content = {
                id: 'content_' + Date.now(),
                title: channel.title,
                poster: channel.poster,
                url: channel.url,
                description: channel.description || '',
                format: channel.format || 'm3u8',
                page: channel.page || 'tv',
                category: channel.category || 'Geral',
                addedBy: currentAdmin.username,
                addedDate: new Date().toISOString(),
                status: 'active',
                fromIPTV: true
            };
            
            adminData.contents.push(content);
            saveAdminData();
            updateDashboard();
            
            alert('Canal adicionado com sucesso!');
        }

        function searchIPTVTMDB() {
            const query = document.getElementById('iptvEditTitle').value;
            if (!query || query.length < 3) {
                alert('Digite pelo menos 3 caracteres para buscar no TMDB');
                return;
            }
            
            // Usar a chave TMDB embutida
            const apiKey = EMBEDDED_TMDB_API_KEY;
            
            showLoading('Buscando no TMDB...');
            
            fetch(`https://api.themoviedb.org/3/search/multi?api_key=${apiKey}&query=${encodeURIComponent(query)}&language=pt-BR`)
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    displayIPTVTMDBResults(data.results);
                })
                .catch(error => {
                    hideLoading();
                    console.error('Erro TMDB:', error);
                    alert('Erro ao buscar no TMDB');
                });
        }

        function displayIPTVTMDBResults(results) {
            const container = document.getElementById('iptvTmdbResults');
            container.innerHTML = '';
            
            if (!results || results.length === 0) {
                container.style.display = 'none';
                return;
            }
            
            const limitedResults = results.slice(0, 5);
            
            limitedResults.forEach(result => {
                const item = document.createElement('div');
                item.className = 'tmdb-result-item';
                
                const posterPath = result.poster_path || result.profile_path;
                const posterUrl = posterPath 
                    ? `https://image.tmdb.org/t/p/w200${posterPath}`
                    : 'https://via.placeholder.com/50x75/333/666?text=No+Image';
                
                const title = result.title || result.name || 'Sem título';
                const year = result.release_date 
                    ? new Date(result.release_date).getFullYear()
                    : result.first_air_date 
                    ? new Date(result.first_air_date).getFullYear()
                    : '';
                
                item.innerHTML = `
                    <img src="${posterUrl}" class="tmdb-poster" alt="${title}">
                    <div class="tmdb-info">
                        <div class="tmdb-title">${title}</div>
                        <div class="tmdb-year">${year}</div>
                    </div>
                `;
                
                item.addEventListener('click', () => {
                    fillIPTVFormWithTMDBData(result);
                    container.style.display = 'none';
                });
                
                container.appendChild(item);
            });
            
            container.style.display = 'block';
        }

        function fillIPTVFormWithTMDBData(result) {
            const title = result.title || result.name || '';
            const posterPath = result.poster_path || result.profile_path;
            const posterUrl = posterPath 
                ? `https://image.tmdb.org/t/p/w500${posterPath}`
                : '';
            const year = result.release_date 
                ? new Date(result.release_date).getFullYear()
                : result.first_air_date 
                ? new Date(result.first_air_date).getFullYear()
                : '';
            const overview = result.overview || '';
            
            document.getElementById('iptvEditTitle').value = title;
            document.getElementById('iptvEditLogo').value = posterUrl;
            document.getElementById('iptvEditDescription').value = overview;
            
            if (result.media_type === 'movie') {
                document.getElementById('iptvEditPage').value = 'filmes';
            } else if (result.media_type === 'tv') {
                document.getElementById('iptvEditPage').value = 'series';
            }
            
            updateIPTVCategories();
        }

        function saveIPTVContent(e) {
            e.preventDefault();
            
            const content = {
                id: document.getElementById('iptvEditId').value.startsWith('content_') 
                    ? document.getElementById('iptvEditId').value
                    : 'content_' + Date.now(),
                title: document.getElementById('iptvEditTitle').value,
                poster: document.getElementById('iptvEditLogo').value,
                url: document.getElementById('iptvEditUrl').value,
                description: document.getElementById('iptvEditDescription').value,
                format: document.getElementById('iptvEditFormat').value,
                page: document.getElementById('iptvEditPage').value,
                category: document.getElementById('iptvEditCategory').value,
                epgId: document.getElementById('iptvEditEpgId').value,
                epgUrl: document.getElementById('iptvEditEpgUrl').value,
                quality: document.getElementById('iptvEditQuality').value,
                addedBy: currentAdmin.username,
                addedDate: new Date().toISOString(),
                status: 'active',
                fromIPTV: true
            };
            
            // Check if updating existing content
            const existingIndex = adminData.contents.findIndex(c => c.id === content.id);
            if (existingIndex !== -1) {
                adminData.contents[existingIndex] = content;
            } else {
                adminData.contents.push(content);
            }
            
            saveAdminData();
            updateDashboard();
            
            alert('Conteúdo IPTV salvo com sucesso!');
            cancelIPTVEdit();
        }

        function deleteIPTVContent() {
            const contentId = document.getElementById('iptvEditId').value;
            if (!contentId) return;
            
            if (confirm('Tem certeza que deseja excluir este conteúdo?')) {
                adminData.contents = adminData.contents.filter(c => c.id !== contentId);
                saveAdminData();
                updateDashboard();
                alert('Conteúdo excluído com sucesso!');
                cancelIPTVEdit();
            }
        }

        function cancelIPTVEdit() {
            document.getElementById('iptvEditForm').reset();
            document.getElementById('iptvEditFormContainer').style.display = 'none';
            document.getElementById('iptvTmdbResults').style.display = 'none';
        }

        // ==============================================
        // FUNÇÕES DE CARREGAMENTO DE RSS
        // ==============================================
        async function loadRSSFeed(feedType) {
            showLoading(`Carregando ${feedType} do GitHub...`);
            
            try {
                const response = await fetch(RSS_FEEDS[feedType]);
                if (!response.ok) {
                    throw new Error(`Erro ao carregar ${feedType}: ${response.status}`);
                }
                
                const text = await response.text();
                let count = 0;
                
                // Verificar se é XML do tipo <series> (TV) ou RSS padrão
                if (text.includes('<series>')) {
                    // Parse XML do tipo <series> (para TV)
                    count = parseSeriesXML(text, feedType);
                } else if (text.includes('<rss')) {
                    // Parse RSS padrão
                    count = parseRSSXML(text, feedType);
                } else {
                    throw new Error('Formato de feed não suportado');
                }
                
                saveAdminData();
                updateDashboard();
                loadAllContents();
                renderContentsGrid();
                
                hideLoading();
                
                alert(`Carregados ${count} novos itens de ${feedType} do GitHub!`);
                
            } catch (error) {
                hideLoading();
                console.error(`Erro ao carregar RSS ${feedType}:`, error);
                alert(`Erro ao carregar ${feedType}: ${error.message}`);
            }
        }

        function parseSeriesXML(xmlText, feedType) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, "text/xml");
            const shows = xmlDoc.querySelectorAll('show');
            let count = 0;
            
            shows.forEach(show => {
                const title = show.querySelector('title')?.textContent || 'Sem título';
                const posterUrl = show.querySelector('posterUrl')?.textContent || '';
                const description = show.querySelector('description')?.textContent || '';
                const genre = show.querySelector('genre')?.textContent || 'Geral';
                
                // Buscar URL do episódio
                const episode = show.querySelector('episode');
                const url = episode?.querySelector('url')?.textContent || '';
                
                if (title && url) {
                    const content = {
                        id: 'rss_' + Date.now() + '_' + count,
                        title: title,
                        poster: posterUrl,
                        url: url,
                        description: description,
                        format: url.includes('.m3u8') ? 'm3u8' : 
                               url.includes('.mp4') ? 'mp4' : 
                               url.includes('.ts') ? 'ts' : 'm3u8',
                        page: feedType,
                        category: getCategoryFromGenre(genre, feedType),
                        year: show.querySelector('year')?.textContent || '',
                        genre: genre,
                        addedBy: 'GitHub RSS',
                        addedDate: new Date().toISOString(),
                        status: 'active',
                        fromRSS: true
                    };
                    
                    // Check if content already exists
                    const exists = adminData.contents.some(c => 
                        c.title === content.title && c.url === content.url
                    );
                    
                    if (!exists) {
                        adminData.contents.push(content);
                        count++;
                    }
                }
            });
            
            return count;
        }

        function parseRSSXML(xmlText, feedType) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, "text/xml");
            const items = xmlDoc.querySelectorAll('item');
            let count = 0;
            
            items.forEach(item => {
                const title = item.querySelector('title')?.textContent || 'Sem título';
                const description = item.querySelector('description')?.textContent || '';
                const category = item.querySelector('category')?.textContent || 'Geral';
                
                // Buscar URL do media:content
                const mediaContent = item.querySelector('media\\:content, content');
                let url = '';
                let thumbnail = '';
                
                if (mediaContent) {
                    url = mediaContent.getAttribute('url') || '';
                    const thumbnailEl = mediaContent.querySelector('media\\:thumbnail, thumbnail');
                    thumbnail = thumbnailEl ? thumbnailEl.getAttribute('url') || '' : '';
                } else {
                    // Tentar pegar do enclosure
                    const enclosure = item.querySelector('enclosure');
                    url = enclosure ? enclosure.getAttribute('url') || '' : '';
                }
                
                if (title && url) {
                    const content = {
                        id: 'rss_' + Date.now() + '_' + count,
                        title: title,
                        poster: thumbnail,
                        url: url,
                        description: description,
                        format: url.includes('.m3u8') ? 'm3u8' : 
                               url.includes('.mp4') ? 'mp4' : 
                               url.includes('.ts') ? 'ts' : 'm3u8',
                        page: feedType,
                        category: getCategoryFromGenre(category, feedType),
                        addedBy: 'GitHub RSS',
                        addedDate: new Date().toISOString(),
                        status: 'active',
                        fromRSS: true
                    };
                    
                    // Check if content already exists
                    const exists = adminData.contents.some(c => 
                        c.title === content.title && c.url === content.url
                    );
                    
                    if (!exists) {
                        adminData.contents.push(content);
                        count++;
                    }
                }
            });
            
            return count;
        }

        function getCategoryFromGenre(genre, feedType) {
            // Mapear gênero para categorias do sistema
            const genreMap = {
                'Infantil': 'Infantil',
                'Aberta': 'Canais Abertos',
                'Notícias': 'Notícias',
                'Esportes': 'Esportes',
                'Entretenimento': 'Variedades',
                'Novelas': 'Novelas',
                'Documentários': 'Documentários',
                'Filmes': 'Filmes',
                'Séries': 'Séries'
            };
            
            for (const [key, value] of Object.entries(genreMap)) {
                if (genre.includes(key)) {
                    return value;
                }
            }
            
            // Fallback baseado no feedType
            switch(feedType) {
                case 'home': return 'Destaques';
                case 'tv': return 'Canais';
                case 'filmes': return 'Ação';
                case 'series': return 'Séries';
                case 'epg': return 'EPG';
                default: return 'Geral';
            }
        }

        async function loadAllRSSFeeds() {
            if (!confirm('Deseja carregar todos os conteúdos dos feeds RSS do GitHub?')) {
                return;
            }
            
            showLoading('Carregando todos os feeds RSS do GitHub...');
            
            let totalLoaded = 0;
            
            try {
                // Carregar cada feed sequencialmente
                for (const [feedType, feedUrl] of Object.entries(RSS_FEEDS)) {
                    if (feedType === 'login') continue; // Pular login feed
                    
                    try {
                        const response = await fetch(feedUrl);
                        if (response.ok) {
                            const text = await response.text();
                            
                            if (text.includes('<series>')) {
                                totalLoaded += parseSeriesXML(text, feedType);
                            } else if (text.includes('<rss')) {
                                totalLoaded += parseRSSXML(text, feedType);
                            }
                            
                            // Pequena pausa entre requests
                            await new Promise(resolve => setTimeout(resolve, 500));
                        }
                    } catch (feedError) {
                        console.error(`Erro no feed ${feedType}:`, feedError);
                    }
                }
                
                saveAdminData();
                updateDashboard();
                loadAllContents();
                renderContentsGrid();
                renderCategoriesGrid(currentPage);
                
                hideLoading();
                
                alert(`Carregamento completo! ${totalLoaded} novos itens adicionados do GitHub.`);
                
            } catch (error) {
                hideLoading();
                console.error('Erro ao carregar feeds RSS:', error);
                alert(`Erro ao carregar feeds: ${error.message}`);
            }
        }

        // ==============================================
        // FUNÇÕES DE GESTÃO DE CONTEÚDO
        // ==============================================
        function updatePreview() {
            const title = document.getElementById('contentTitle').value || 'Título do Conteúdo';
            const poster = document.getElementById('contentPoster').value;
            const page = document.getElementById('contentPage').value || '-';
            const category = document.getElementById('contentCategory').value || '-';
            
            document.getElementById('previewTitle').textContent = title;
            document.getElementById('previewMeta').textContent = `Página: ${page.toUpperCase()} | Categoria: ${category}`;
            
            if (poster) {
                document.getElementById('previewImage').style.backgroundImage = `url('${poster}')`;
            } else {
                document.getElementById('previewImage').style.backgroundImage = 'none';
                document.getElementById('previewImage').style.backgroundColor = 'rgba(255,255,255,0.1)';
            }
        }

        function addContent(e) {
            e.preventDefault();
            
            const content = {
                id: 'content_' + Date.now(),
                title: document.getElementById('contentTitle').value,
                poster: document.getElementById('contentPoster').value,
                url: document.getElementById('contentUrl').value,
                description: document.getElementById('contentDescription').value,
                format: document.getElementById('contentFormat').value,
                page: document.getElementById('contentPage').value,
                category: document.getElementById('contentCategory').value,
                year: document.getElementById('contentYear').value,
                genre: document.getElementById('contentGenre').value,
                addedBy: currentAdmin.username,
                addedDate: new Date().toISOString(),
                status: 'active'
            };
            
            adminData.contents.push(content);
            saveAdminData();
            updateDashboard();
            loadAllContents();
            renderContentsGrid();
            renderCategoriesGrid(currentPage);
            
            alert('Conteúdo adicionado com sucesso!');
            resetAddForm();
        }

        function resetAddForm() {
            document.getElementById('addContentForm').reset();
            document.getElementById('contentFormat').value = 'm3u8';
            document.querySelectorAll('.format-btn').forEach(btn => {
                btn.classList.remove('btn-primary-admin');
                btn.classList.add('btn-outline-light');
            });
            document.querySelector('.format-btn[data-format="m3u8"]').classList.remove('btn-outline-light');
            document.querySelector('.format-btn[data-format="m3u8"]').classList.add('btn-primary-admin');
            document.getElementById('tmdbResults').style.display = 'none';
            updatePreview();
        }

        function loadAllContents() {
            const tableBody = document.getElementById('contentsTableBody');
            tableBody.innerHTML = '';
            
            // Filter by current page if set
            let contents = adminData.contents;
            if (currentPage) {
                contents = contents.filter(c => c.page === currentPage);
            }
            if (currentCategory) {
                contents = contents.filter(c => c.category === currentCategory);
            }
            
            contents.forEach(content => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${content.title}</td>
                    <td><span class="status-badge">${content.page.toUpperCase()}</span></td>
                    <td>${content.category}</td>
                    <td>${new Date(content.addedDate).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-sm btn-primary-admin me-1" onclick="openEditContent('${content.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger-admin" onclick="deleteContentById('${content.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function filterContentsEdit() {
            const page = document.getElementById('filterPageEdit').value;
            loadAllContents();
        }

        function searchContents() {
            const searchTerm = document.getElementById('searchContent').value.toLowerCase();
            const tableBody = document.getElementById('contentsTableBody');
            tableBody.innerHTML = '';
            
            let contents = adminData.contents;
            
            // Apply page filter if set
            const pageFilter = document.getElementById('filterPageEdit').value;
            if (pageFilter) {
                contents = contents.filter(c => c.page === pageFilter);
            }
            
            // Apply search filter
            const filtered = contents.filter(content => 
                content.title.toLowerCase().includes(searchTerm) ||
                (content.description && content.description.toLowerCase().includes(searchTerm)) ||
                content.category.toLowerCase().includes(searchTerm) ||
                (content.genre && content.genre.toLowerCase().includes(searchTerm))
            );
            
            filtered.forEach(content => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${content.title}</td>
                    <td><span class="status-badge">${content.page.toUpperCase()}</span></td>
                    <td>${content.category}</td>
                    <td>${new Date(content.addedDate).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-sm btn-primary-admin me-1" onclick="openEditContent('${content.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger-admin" onclick="deleteContentById('${content.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function globalSearchContent() {
            const searchTerm = document.getElementById('globalSearchContent').value.toLowerCase();
            if (!searchTerm) {
                return;
            }
            
            // Buscar em todos os conteúdos
            const results = adminData.contents.filter(content => 
                content.title.toLowerCase().includes(searchTerm) ||
                (content.description && content.description.toLowerCase().includes(searchTerm)) ||
                content.category.toLowerCase().includes(searchTerm)
            );
            
            if (results.length === 0) {
                alert('Nenhum conteúdo encontrado!');
                return;
            }
            
            // Mostrar resultados
            const resultText = results.map((content, index) => 
                `${index + 1}. ${content.title} (${content.page} - ${content.category})`
            ).join('\n');
            
            alert(`Resultados da busca:\n\n${resultText}`);
        }

        function filterContentsView() {
            renderContentsGrid();
        }

        function renderContentsGrid() {
            const grid = document.getElementById('contentsGrid');
            grid.innerHTML = '';
            
            let contents = adminData.contents;
            
            // Apply page filter
            const pageFilter = document.getElementById('filterPageView').value;
            if (pageFilter) {
                contents = contents.filter(c => c.page === pageFilter);
            }
            
            // Apply category filter
            const categoryFilter = document.getElementById('filterCategoryView').value;
            if (categoryFilter) {
                contents = contents.filter(c => c.category === categoryFilter);
            }
            
            // Update category dropdown
            updateCategoryFilterDropdown(pageFilter);
            
            if (contents.length === 0) {
                grid.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-film fa-3x mb-3 text-muted"></i>
                        <h4>Nenhum conteúdo encontrado</h4>
                        <p class="text-muted">Tente alterar os filtros ou adicionar novos conteúdos.</p>
                    </div>
                `;
                return;
            }
            
            contents.forEach(content => {
                const col = document.createElement('div');
                col.className = 'col-md-3 col-sm-6';
                col.innerHTML = `
                    <div class="content-preview">
                        <div class="preview-image" style="${content.poster ? `background-image: url('${content.poster}')` : 'background-color: rgba(255,255,255,0.1)'}">
                            <div style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 2px 8px; border-radius: 3px; font-size: 11px; font-weight: bold;">
                                ${content.format.toUpperCase()}
                            </div>
                        </div>
                        <div class="preview-title">${content.title}</div>
                        <div class="preview-meta">
                            ${content.page.toUpperCase()} • ${content.category}
                        </div>
                        <div class="mt-2">
                            <button class="btn btn-sm btn-primary-admin me-1" onclick="openEditContent('${content.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger-admin" onclick="deleteContentById('${content.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(col);
            });
        }

        function updateCategoryFilterDropdown(page) {
            const dropdown = document.getElementById('filterCategoryView');
            dropdown.innerHTML = '<option value="">Todas Categorias</option>';
            
            if (!page) return;
            
            let categories = [];
            const pageData = CATEGORIES_BY_PAGE[page];
            
            if (Array.isArray(pageData)) {
                // For HOME page
                categories = pageData;
            } else if (typeof pageData === 'object') {
                // For other pages, flatten all categories
                for (const groupCategories of Object.values(pageData)) {
                    categories = categories.concat(groupCategories);
                }
            }
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                dropdown.appendChild(option);
            });
        }

        // ==============================================
        // FUNÇÕES TMDB API
        // ==============================================
        async function searchTMDB(query) {
            if (!query || query.length < 3) {
                document.getElementById('tmdbResults').style.display = 'none';
                return;
            }
            
            // Usar a chave TMDB embutida
            const apiKey = EMBEDDED_TMDB_API_KEY;
            
            try {
                const response = await fetch(
                    `https://api.themoviedb.org/3/search/multi?api_key=${apiKey}&query=${encodeURIComponent(query)}&language=pt-BR`
                );
                
                if (!response.ok) {
                    throw new Error('Erro na busca TMDB');
                }
                
                const data = await response.json();
                displayTMDBResults(data.results);
                
            } catch (error) {
                console.error('Erro na busca TMDB:', error);
                document.getElementById('tmdbResults').style.display = 'none';
            }
        }

        function displayTMDBResults(results) {
            const container = document.getElementById('tmdbResults');
            container.innerHTML = '';
            
            if (!results || results.length === 0) {
                container.style.display = 'none';
                return;
            }
            
            // Limitar a 10 resultados
            const limitedResults = results.slice(0, 10);
            
            limitedResults.forEach(result => {
                const item = document.createElement('div');
                item.className = 'tmdb-result-item';
                
                const posterPath = result.poster_path || result.profile_path;
                const posterUrl = posterPath 
                    ? `https://image.tmdb.org/t/p/w200${posterPath}`
                    : 'https://via.placeholder.com/50x75/333/666?text=No+Image';
                
                const title = result.title || result.name || 'Sem título';
                const year = result.release_date 
                    ? new Date(result.release_date).getFullYear()
                    : result.first_air_date 
                    ? new Date(result.first_air_date).getFullYear()
                    : '';
                
                item.innerHTML = `
                    <img src="${posterUrl}" class="tmdb-poster" alt="${title}">
                    <div class="tmdb-info">
                        <div class="tmdb-title">${title}</div>
                        <div class="tmdb-year">${year}</div>
                    </div>
                `;
                
                item.addEventListener('click', () => {
                    fillFormWithTMDBData(result);
                    container.style.display = 'none';
                });
                
                container.appendChild(item);
            });
            
            container.style.display = 'block';
        }

        function fillFormWithTMDBData(result) {
            const title = result.title || result.name || '';
            const posterPath = result.poster_path || result.profile_path;
            const posterUrl = posterPath 
                ? `https://image.tmdb.org/t/p/w500${posterPath}`
                : '';
            const year = result.release_date 
                ? new Date(result.release_date).getFullYear()
                : result.first_air_date 
                ? new Date(result.first_air_date).getFullYear()
                : '';
            const overview = result.overview || '';
            
            // Preencher formulário
            document.getElementById('contentTitle').value = title;
            document.getElementById('contentPoster').value = posterUrl;
            document.getElementById('contentYear').value = year;
            document.getElementById('contentDescription').value = overview;
            
            // Se for filme ou série, definir página automaticamente
            if (result.media_type === 'movie') {
                document.getElementById('contentPage').value = 'filmes';
                document.getElementById('contentGenre').value = 'Filme';
            } else if (result.media_type === 'tv') {
                document.getElementById('contentPage').value = 'series';
                document.getElementById('contentGenre').value = 'Série';
            }
            
            // Atualizar categorias
            updateCategoriesByPage();
            
            // Atualizar preview
            updatePreview();
        }

        // ==============================================
        // FUNÇÕES DE GESTÃO DE CÓDIGOS
        // ==============================================
        function generateRandomCode(length = 12) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function generateCodes(e) {
            e.preventDefault();
            
            const quantity = parseInt(document.getElementById('codeQuantity').value);
            const uses = parseInt(document.getElementById('codeUses').value);
            const plan = document.getElementById('codePlan').value;
            const expiry = document.getElementById('codeExpiry').value;
            
            const generatedCodes = [];
            const codeList = document.getElementById('generatedCodesList');
            
            codeList.innerHTML = '';
            
            for (let i = 0; i < quantity; i++) {
                const codeValue = generateRandomCode();
                const code = {
                    id: 'code_' + Date.now() + '_' + i,
                    code: codeValue,
                    plan: plan,
                    maxUses: uses,
                    used: 0,
                    expiry: expiry,
                    created: new Date().toISOString(),
                    createdBy: currentAdmin.username,
                    status: 'active'
                };
                
                adminData.codes.push(code);
                generatedCodes.push(codeValue);
                
                // Add to UI
                const codeDiv = document.createElement('div');
                codeDiv.className = 'generated-code';
                codeDiv.textContent = `${codeValue} - ${plan} (Usos: ${uses})`;
                codeList.appendChild(codeDiv);
            }
            
            // Update codes table
            loadAllCodes();
            updateDashboard();
            saveAdminData();
            
            // Show success message
            alert(`${quantity} código(s) gerado(s) com sucesso!`);
            
            // Clear form
            document.getElementById('generateCodeForm').reset();
            
            // Set default expiry date
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            document.getElementById('codeExpiry').value = nextMonth.toISOString().split('T')[0];
        }

        function loadAllCodes() {
            const tableBody = document.getElementById('codesTableBody');
            tableBody.innerHTML = '';
            
            adminData.codes.forEach(code => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${code.code}</strong></td>
                    <td>${code.used}/${code.maxUses}</td>
                    <td>${new Date(code.expiry).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-sm btn-danger-admin" onclick="deleteCode('${code.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function deleteCode(codeId) {
            if (confirm('Tem certeza que deseja excluir este código?')) {
                adminData.codes = adminData.codes.filter(c => c.id !== codeId);
                saveAdminData();
                loadAllCodes();
                updateDashboard();
            }
        }

        function copyAllCodes() {
            const codeElements = document.querySelectorAll('#generatedCodesList .generated-code');
            if (codeElements.length === 0) {
                alert('Nenhum código para copiar!');
                return;
            }
            
            let codesText = '';
            codeElements.forEach(el => {
                codesText += el.textContent + '\n';
            });
            
            navigator.clipboard.writeText(codesText).then(() => {
                alert('Códigos copiados para a área de transferência!');
            });
        }

        function clearAllCodes() {
            if (confirm('Tem certeza que deseja apagar todos os códigos gerados?')) {
                document.getElementById('generatedCodesList').innerHTML = '';
            }
        }

        // ==============================================
        // FUNÇÕES DE GESTÃO DE USUÁRIOS
        // ==============================================
        function addRssServer() {
            const container = document.getElementById('rssServersContainer');
            const div = document.createElement('div');
            div.className = 'input-group mb-2';
            div.innerHTML = `
                <input type="text" class="form-control rss-server" 
                       value="https://raw.githubusercontent.com/Fu6rfho5zf/FlixTv4k/refs/heads/main/FlixHome.rss">
                <button class="btn btn-danger" type="button" onclick="removeRssServer(this)">×</button>
            `;
            container.appendChild(div);
        }

        function removeRssServer(button) {
            button.closest('.input-group').remove();
        }

        function createUser(e) {
            e.preventDefault();
            
            // Coletar servidores RSS
            const rssServers = [];
            document.querySelectorAll('.rss-server').forEach(input => {
                if (input.value.trim()) {
                    rssServers.push(input.value.trim());
                }
            });
            
            const user = {
                id: 'user_' + Date.now(),
                username: document.getElementById('userName').value,
                password: document.getElementById('userPassword').value,
                email: document.getElementById('userEmail').value,
                phone: document.getElementById('userPhone').value,
                createDate: document.getElementById('userCreateDate').value,
                renewDate: document.getElementById('userRenewDate').value,
                plan: document.getElementById('userPlan').value,
                role: document.getElementById('userRole').value,
                rssServers: rssServers,
                status: 'active',
                createdBy: currentAdmin.username,
                created: new Date().toISOString()
            };
            
            adminData.users.push(user);
            saveAdminData();
            updateDashboard();
            loadAllUsers();
            
            alert('Usuário criado com sucesso!');
            resetUserForm();
        }

        function resetUserForm() {
            document.getElementById('createUserForm').reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('userCreateDate').value = today;
            document.getElementById('userRenewDate').value = today;
            document.getElementById('userRole').value = 'user';
            
            // Reset RSS servers
            const container = document.getElementById('rssServersContainer');
            container.innerHTML = `
                <div class="input-group mb-2">
                    <input type="text" class="form-control rss-server" 
                           value="https://raw.githubusercontent.com/Fu6rfho5zf/FlixTv4k/refs/heads/main/FlixHome.rss">
                    <button class="btn btn-danger" type="button" onclick="removeRssServer(this)">×</button>
                </div>
            `;
        }

        function loadAllUsers() {
            const tableBody = document.getElementById('usersTableBody');
            tableBody.innerHTML = '';
            
            // Filter out admin users from display
            const users = adminData.users.filter(u => u.role !== 'superadmin');
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.plan}</td>
                    <td>${user.role}</td>
                    <td><span class="status-badge status-active">Ativo</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary-admin me-1" onclick="openEditUser('${user.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger-admin" onclick="deleteUserById('${user.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function openEditUser(userId) {
            const user = adminData.users.find(u => u.id === userId);
            if (!user) return;
            
            document.getElementById('editUserId').value = user.id;
            document.getElementById('editUserName').value = user.username;
            document.getElementById('editUserEmail').value = user.email || '';
            document.getElementById('editUserPhone').value = user.phone || '';
            document.getElementById('editUserCreateDate').value = user.createDate;
            document.getElementById('editUserRenewDate').value = user.renewDate;
            document.getElementById('editUserPlan').value = user.plan;
            document.getElementById('editUserRole').value = user.role || 'user';
            
            const modal = new bootstrap.Modal(document.getElementById('editUserModal'));
            modal.show();
        }

        function saveEditedUser() {
            const userId = document.getElementById('editUserId').value;
            const userIndex = adminData.users.findIndex(u => u.id === userId);
            
            if (userIndex !== -1) {
                adminData.users[userIndex].username = document.getElementById('editUserName').value;
                adminData.users[userIndex].email = document.getElementById('editUserEmail').value;
                adminData.users[userIndex].phone = document.getElementById('editUserPhone').value;
                adminData.users[userIndex].createDate = document.getElementById('editUserCreateDate').value;
                adminData.users[userIndex].renewDate = document.getElementById('editUserRenewDate').value;
                adminData.users[userIndex].plan = document.getElementById('editUserPlan').value;
                adminData.users[userIndex].role = document.getElementById('editUserRole').value;
                
                saveAdminData();
                loadAllUsers();
                updateDashboard();
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('editUserModal'));
                modal.hide();
                
                alert('Usuário atualizado com sucesso!');
            }
        }

        function deleteUser() {
            const userId = document.getElementById('editUserId').value;
            if (confirm('Tem certeza que deseja excluir este usuário?')) {
                adminData.users = adminData.users.filter(u => u.id !== userId);
                saveAdminData();
                loadAllUsers();
                updateDashboard();
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('editUserModal'));
                modal.hide();
                
                alert('Usuário excluído com sucesso!');
            }
        }

        function deleteUserById(userId) {
            if (confirm('Tem certeza que deseja excluir este usuário?')) {
                adminData.users = adminData.users.filter(u => u.id !== userId);
                saveAdminData();
                loadAllUsers();
                updateDashboard();
                alert('Usuário excluído com sucesso!');
            }
        }

        // ==============================================
        // FUNÇÕES DE EDITAR CONTEÚDO
        // ==============================================
        function openEditContent(contentId) {
            const content = adminData.contents.find(c => c.id === contentId);
            if (!content) return;
            
            document.getElementById('editContentId').value = content.id;
            document.getElementById('editContentTitle').value = content.title;
            document.getElementById('editContentPoster').value = content.poster || '';
            document.getElementById('editContentUrl').value = content.url;
            document.getElementById('editContentDescription').value = content.description || '';
            document.getElementById('editContentPage').value = content.page;
            document.getElementById('editContentFormat').value = content.format;
            document.getElementById('editContentYear').value = content.year || '';
            document.getElementById('editContentGenre').value = content.genre || '';
            
            // Update categories for the page
            updateEditCategories();
            
            // Set category value
            setTimeout(() => {
                document.getElementById('editContentCategory').value = content.category;
            }, 100);
            
            // Configurar opções de mover conteúdo
            setupMoveContentOptions();
            
            const modal = new bootstrap.Modal(document.getElementById('editContentModal'));
            modal.show();
        }

        function setupMoveContentOptions() {
            const pageSelect = document.getElementById('moveContentPage');
            const categorySelect = document.getElementById('moveContentCategory');
            
            pageSelect.value = document.getElementById('editContentPage').value;
            
            // Atualizar categorias quando página mudar
            pageSelect.addEventListener('change', function() {
                updateMoveCategories(this.value);
            });
            
            // Carregar categorias iniciais
            updateMoveCategories(pageSelect.value);
        }

        function updateMoveCategories(page) {
            const categorySelect = document.getElementById('moveContentCategory');
            categorySelect.innerHTML = '<option value="">Selecione categoria</option>';
            
            if (!page) return;
            
            let categories = [];
            const pageData = CATEGORIES_BY_PAGE[page];
            
            if (Array.isArray(pageData)) {
                // For HOME page
                categories = pageData;
            } else if (typeof pageData === 'object') {
                // For other pages, flatten all categories
                for (const groupCategories of Object.values(pageData)) {
                    categories = categories.concat(groupCategories);
                }
            }
            
            // Adicionar categorias temporárias ativas
            const activeTempCategories = adminData.tempCategories.filter(cat => 
                cat.page === page && cat.status === 'active'
            );
            
            activeTempCategories.forEach(tempCat => {
                categories.push(tempCat.name + ' ⏰');
            });
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.replace(' ⏰', '');
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }

        function moveContentToPage() {
            const contentId = document.getElementById('editContentId').value;
            const newPage = document.getElementById('moveContentPage').value;
            const newCategory = document.getElementById('moveContentCategory').value;
            
            if (!newCategory) {
                alert('Por favor, selecione uma categoria!');
                return;
            }
            
            const contentIndex = adminData.contents.findIndex(c => c.id === contentId);
            if (contentIndex !== -1) {
                adminData.contents[contentIndex].page = newPage;
                adminData.contents[contentIndex].category = newCategory;
                
                saveAdminData();
                updateDashboard();
                
                alert(`Conteúdo movido para: ${newPage.toUpperCase()} - ${newCategory}`);
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('editContentModal'));
                modal.hide();
            }
        }

        function saveEditedContent() {
            const contentId = document.getElementById('editContentId').value;
            const contentIndex = adminData.contents.findIndex(c => c.id === contentId);
            
            if (contentIndex !== -1) {
                adminData.contents[contentIndex].title = document.getElementById('editContentTitle').value;
                adminData.contents[contentIndex].poster = document.getElementById('editContentPoster').value;
                adminData.contents[contentIndex].url = document.getElementById('editContentUrl').value;
                adminData.contents[contentIndex].description = document.getElementById('editContentDescription').value;
                adminData.contents[contentIndex].page = document.getElementById('editContentPage').value;
                adminData.contents[contentIndex].category = document.getElementById('editContentCategory').value;
                adminData.contents[contentIndex].format = document.getElementById('editContentFormat').value;
                adminData.contents[contentIndex].year = document.getElementById('editContentYear').value;
                adminData.contents[contentIndex].genre = document.getElementById('editContentGenre').value;
                
                saveAdminData();
                loadAllContents();
                renderContentsGrid();
                updateDashboard();
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('editContentModal'));
                modal.hide();
                
                alert('Conteúdo atualizado com sucesso!');
            }
        }

        function deleteContent() {
            const contentId = document.getElementById('editContentId').value;
            if (confirm('Tem certeza que deseja excluir este conteúdo?')) {
                adminData.contents = adminData.contents.filter(c => c.id !== contentId);
                saveAdminData();
                loadAllContents();
                renderContentsGrid();
                updateDashboard();
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('editContentModal'));
                modal.hide();
                
                alert('Conteúdo excluído com sucesso!');
            }
        }

        function deleteContentById(contentId) {
            if (confirm('Tem certeza que deseja excluir este conteúdo?')) {
                adminData.contents = adminData.contents.filter(c => c.id !== contentId);
                saveAdminData();
                loadAllContents();
                renderContentsGrid();
                updateDashboard();
                alert('Conteúdo excluído com sucesso!');
            }
        }

        // ==============================================
        // FUNÇÕES DE GITHUB
        // ==============================================
        function toggleTokenVisibility() {
            const tokenInput = document.getElementById('githubToken');
            tokenInput.type = tokenInput.type === 'password' ? 'text' : 'password';
        }

        function editGitHubToken() {
            const tokenInput = document.getElementById('githubToken');
            const newToken = prompt('Digite o novo token do GitHub:', tokenInput.value);
            if (newToken !== null) {
                tokenInput.value = newToken;
                adminData.settings.githubToken = newToken;
                saveAdminData();
                alert('Token atualizado com sucesso!');
            }
        }

        async function sendToGithub(type) {
            const token = document.getElementById('githubToken').value;
            if (!token) {
                alert('Por favor, insira um token do GitHub!');
                return;
            }

            showLoading(`Enviando ${type === 'all' ? 'todos os arquivos' : type} para o GitHub...`);

            try {
                // Lista de arquivos a serem enviados
                const filesToSend = type === 'all' ? ['home', 'tv', 'filmes', 'series', 'epg', 'login'] : [type];
                const repo = document.getElementById('githubRepo').value;
                const [owner, repoName] = repo.split('/');
                
                let totalSuccess = 0;
                let totalFailed = 0;
                let errorMessages = [];

                // Para cada arquivo a ser enviado
                for (const fileType of filesToSend) {
                    try {
                        // Gerar conteúdo do arquivo baseado no tipo
                        const content = generateFileContent(fileType);
                        const fileName = getFileName(fileType);
                        
                        // Criar payload para GitHub API
                        const payload = {
                            message: `Atualização: ${fileName}`,
                            content: btoa(unescape(encodeURIComponent(content))),
                            branch: 'main'
                        };

                        // Primeiro, verificar se o arquivo já existe
                        const checkResponse = await fetch(`https://api.github.com/repos/${owner}/${repoName}/contents/${fileName}`, {
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });

                        if (checkResponse.status === 200) {
                            // Arquivo existe, precisamos do SHA para atualizar
                            const existingFile = await checkResponse.json();
                            payload.sha = existingFile.sha;
                        }

                        // Enviar para GitHub
                        const response = await fetch(`https://api.github.com/repos/${owner}/${repoName}/contents/${fileName}`, {
                            method: 'PUT',
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            totalSuccess++;
                            console.log(`Arquivo ${fileName} enviado com sucesso!`);
                        } else {
                            const errorData = await response.json();
                            totalFailed++;
                            errorMessages.push(`${fileType}: ${errorData.message || 'Erro desconhecido'}`);
                            console.error(`Erro ao enviar ${fileName}:`, errorData);
                        }

                        // Pequena pausa entre requests para evitar rate limiting
                        await new Promise(resolve => setTimeout(resolve, 1000));

                    } catch (fileError) {
                        totalFailed++;
                        errorMessages.push(`${fileType}: ${fileError.message}`);
                        console.error(`Erro no arquivo ${fileType}:`, fileError);
                    }
                }

                hideLoading();
                
                // Adicionar ao histórico de sincronizações
                const syncRecord = {
                    id: 'sync_' + Date.now(),
                    date: new Date().toISOString(),
                    file: type === 'all' ? 'Todos os arquivos' : `${type}.rss`,
                    status: totalFailed === 0 ? 'success' : 'partial',
                    admin: currentAdmin.username,
                    details: totalFailed === 0 ? 
                        `${totalSuccess} arquivo(s) enviado(s)` : 
                        `${totalSuccess} enviados, ${totalFailed} falhas`
                };
                
                adminData.syncHistory.unshift(syncRecord);
                adminData.stats.lastSync = new Date().toISOString();
                
                saveAdminData();
                loadSyncHistory();
                updateDashboard();
                
                // Mostrar resultado
                let statusHtml = '';
                if (totalFailed === 0) {
                    statusHtml = `
                        <div class="alert alert-success-admin">
                            <i class="fas fa-check-circle me-2"></i>
                            ${type === 'all' ? 'Todos os arquivos' : type.toUpperCase()} enviados com sucesso para o GitHub!
                            <br><small>${totalSuccess} arquivo(s) atualizado(s)</small>
                        </div>
                    `;
                } else if (totalSuccess > 0) {
                    statusHtml = `
                        <div class="alert alert-warning-admin">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Envio parcialmente bem-sucedido!
                            <br><small>${totalSuccess} enviados, ${totalFailed} falhas</small>
                            <br><small>Erros: ${errorMessages.join(', ')}</small>
                        </div>
                    `;
                } else {
                    statusHtml = `
                        <div class="alert alert-danger-admin">
                            <i class="fas fa-times-circle me-2"></i>
                            Falha ao enviar para o GitHub!
                            <br><small>${errorMessages.join(', ')}</small>
                        </div>
                    `;
                }
                
                document.getElementById('githubStatus').innerHTML = statusHtml;
                
                // Atualizar status no dashboard
                document.getElementById('lastSync').textContent = 
                    new Date().toLocaleDateString();
                document.getElementById('syncStatus').textContent = 'Sincronizado';
                
            } catch (error) {
                hideLoading();
                console.error('Erro ao enviar para GitHub:', error);
                
                document.getElementById('githubStatus').innerHTML = `
                    <div class="alert alert-danger-admin">
                        <i class="fas fa-times-circle me-2"></i>
                        Erro ao conectar com GitHub: ${error.message}
                        <br><small>Verifique seu token e conexão com a internet</small>
                    </div>
                `;
            }
        }

        function generateFileContent(fileType) {
            // Filtrar conteúdos por tipo
            const filteredContents = adminData.contents.filter(content => {
                if (fileType === 'home') return content.page === 'home';
                if (fileType === 'tv') return content.page === 'tv';
                if (fileType === 'filmes') return content.page === 'filmes';
                if (fileType === 'series') return content.page === 'series';
                if (fileType === 'epg') return content.page === 'epg';
                if (fileType === 'login') {
                    // Gerar arquivo de login com usuários
                    return false; // Será tratado separadamente
                }
                return false;
            });
            
            // Gerar XML/RSS baseado no tipo
            if (fileType === 'tv') {
                return generateSeriesXML(filteredContents, fileType);
            } else if (fileType === 'login') {
                return generateLoginXML();
            } else {
                return generateRSSXML(filteredContents, fileType);
            }
        }

        function generateLoginXML() {
            let xml = `<?xml version="1.0" encoding="UTF-8"?>\n`;
            xml += `<rss version="2.0">\n`;
            xml += `  <channel>\n`;
            xml += `    <title>FlixLogin</title>\n`;
            xml += `    <description>Usuários do FLIX TV Max</description>\n`;
            xml += `    <lastBuildDate>${new Date().toUTCString()}</lastBuildDate>\n`;
            
            adminData.users.forEach(user => {
                xml += `    <item>\n`;
                xml += `      <username>${user.username}</username>\n`;
                xml += `      <password>${user.password}</password>\n`;
                xml += `      <subscription>${user.plan}</subscription>\n`;
                xml += `      <expiry>${user.renewDate}</expiry>\n`;
                xml += `      <cargo>${user.role}</cargo>\n`;
                xml += `    </item>\n`;
            });
            
            xml += `  </channel>\n`;
            xml += `</rss>`;
            return xml;
        }

        function generateSeriesXML(contents, fileType) {
            let xml = `<?xml version="1.0" encoding="UTF-8"?>\n`;
            xml += `<series>\n`;
            
            contents.forEach((content, index) => {
                xml += `  <show>\n`;
                xml += `    <title><![CDATA[${content.title || ''}]]></title>\n`;
                xml += `    <posterUrl><![CDATA[${content.poster || ''}]]></posterUrl>\n`;
                xml += `    <description><![CDATA[${content.description || ''}]]></description>\n`;
                xml += `    <genre><![CDATA[${content.category || 'Geral'}]]></genre>\n`;
                xml += `    <year>${content.year || ''}</year>\n`;
                xml += `    <episode>\n`;
                xml += `      <url><![CDATA[${content.url || ''}]]></url>\n`;
                xml += `    </episode>\n`;
                xml += `  </show>\n`;
            });
            
            xml += `</series>`;
            return xml;
        }

        function generateRSSXML(contents, fileType) {
            let xml = `<?xml version="1.0" encoding="UTF-8"?>\n`;
            xml += `<rss version="2.0" xmlns:media="http://search.yahoo.com/mrss/">\n`;
            xml += `  <channel>\n`;
            xml += `    <title>Flix${fileType.charAt(0).toUpperCase() + fileType.slice(1)}</title>\n`;
            xml += `    <description>Conteúdo ${fileType} do FLIX TV Max</description>\n`;
            xml += `    <lastBuildDate>${new Date().toUTCString()}</lastBuildDate>\n`;
            
            contents.forEach((content, index) => {
                xml += `    <item>\n`;
                xml += `      <title><![CDATA[${content.title || ''}]]></title>\n`;
                xml += `      <description><![CDATA[${content.description || ''}]]></description>\n`;
                xml += `      <category><![CDATA[${content.category || 'Geral'}]]></category>\n`;
                xml += `      <pubDate>${new Date(content.addedDate || Date.now()).toUTCString()}</pubDate>\n`;
                
                if (content.poster) {
                    xml += `      <media:content url="${content.url}" type="${getMediaType(content.format)}">\n`;
                    xml += `        <media:thumbnail url="${content.poster}"/>\n`;
                    xml += `      </media:content>\n`;
                } else {
                    xml += `      <enclosure url="${content.url}" type="${getMediaType(content.format)}"/>\n`;
                }
                
                xml += `    </item>\n`;
            });
            
            xml += `  </channel>\n`;
            xml += `</rss>`;
            return xml;
        }

        function getMediaType(format) {
            const mediaTypes = {
                'm3u8': 'application/vnd.apple.mpegurl',
                'mp4': 'video/mp4',
                'ts': 'video/mp2t',
                'm3u': 'audio/x-mpegurl'
            };
            return mediaTypes[format] || 'video/mp4';
        }

        function getFileName(fileType) {
            const fileNames = {
                'home': 'FlixHome.rss',
                'tv': 'FlixCanais.rss',
                'filmes': 'FlixFilmes.rss',
                'series': 'FlixSeries.rss',
                'epg': 'FlixEpg.rss',
                'login': 'FlixLogin.rss'
            };
            return fileNames[fileType] || `${fileType}.rss`;
        }

        function loadSyncHistory() {
            const tableBody = document.getElementById('syncHistory');
            tableBody.innerHTML = '';
            
            adminData.syncHistory.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(record.date).toLocaleString()}</td>
                    <td>${record.file}</td>
                    <td><span class="status-badge ${record.status === 'success' ? 'status-active' : record.status === 'partial' ? 'status-warning' : 'status-inactive'}">${record.status}</span></td>
                    <td>${record.admin}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // ==============================================
        // FUNÇÕES DE IMPORTAR IPTV
        // ==============================================
        async function importM3UFromUrl(e) {
            e.preventDefault();
            
            const url = document.getElementById('importM3UUrl').value;
            const type = document.getElementById('importM3UType').value;
            const autoDetect = document.getElementById('autoDetectCategories').checked;
            
            if (!url) {
                alert('Por favor, insira a URL da lista M3U!');
                return;
            }
            
            showLoading('Importando lista M3U...');
            
            try {
                const response = await fetch(`https://corsproxy.io/?${encodeURIComponent(url)}`);
                if (!response.ok) {
                    throw new Error(`Falha ao carregar lista: ${response.status}`);
                }
                
                const m3uContent = await response.text();
                processM3UContent(m3uContent, type, autoDetect);
                
            } catch (error) {
                hideLoading();
                console.error('Erro ao importar M3U:', error);
                alert(`Erro ao importar lista: ${error.message}`);
            }
        }

        async function uploadM3UFile() {
            const fileInput = document.getElementById('importM3UFile');
            const type = document.getElementById('uploadM3UType').value;
            const autoDetect = document.getElementById('autoDetectCategoriesUpload').checked;
            
            if (!fileInput.files.length) {
                alert('Por favor, selecione um arquivo M3U!');
                return;
            }
            
            showLoading('Processando arquivo M3U...');
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const m3uContent = e.target.result;
                    processM3UContent(m3uContent, type, autoDetect);
                } catch (error) {
                    hideLoading();
                    console.error('Erro ao processar M3U:', error);
                    alert(`Erro ao processar arquivo: ${error.message}`);
                }
            };
            
            reader.readAsText(file);
        }

        function processM3UContent(m3uContent, type, autoDetect) {
            const lines = m3uContent.split('\n');
            importedItems = [];
            detectedIPTVCategories = [];
            
            let currentItem = null;
            let categoryCounts = {};
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.startsWith('#EXTINF:')) {
                    currentItem = parseEXTINF(line, type);
                } else if (line && !line.startsWith('#') && currentItem) {
                    currentItem.url = line;
                    
                    // Detectar categoria automaticamente se ativado
                    if (autoDetect && currentItem.category) {
                        if (!categoryCounts[currentItem.category]) {
                            categoryCounts[currentItem.category] = 0;
                            detectedIPTVCategories.push(currentItem.category);
                        }
                        categoryCounts[currentItem.category]++;
                    }
                    
                    importedItems.push({...currentItem});
                    currentItem = null;
                }
            }
            
            hideLoading();
            
            // Mostrar categorias detectadas
            if (autoDetect && detectedIPTVCategories.length > 0) {
                showDetectedCategories(detectedIPTVCategories, categoryCounts);
            }
            
            // Renderizar conteúdo importado
            renderImportedContent();
            
            alert(`Importação concluída! ${importedItems.length} itens encontrados.`);
        }

        function parseEXTINF(line, type) {
            // Exemplo: #EXTINF:-1 tvg-id="" tvg-name="NOME" tvg-logo="LOGO" group-title="CATEGORIA",NOME DO CANAL
            const item = {
                id: 'import_' + Date.now() + '_' + importedItems.length,
                title: '',
                poster: '',
                url: '',
                type: type,
                category: 'Geral',
                page: type === 'tv' ? 'tv' : type
            };
            
            // Extrair nome do canal (após a última vírgula)
            const lastComma = line.lastIndexOf(',');
            if (lastComma !== -1) {
                item.title = line.substring(lastComma + 1).trim();
            }
            
            // Extrair atributos
            const attrs = line.substring(8, lastComma !== -1 ? lastComma : line.length);
            
            // Extrair tvg-logo (logo)
            const logoMatch = attrs.match(/tvg-logo="([^"]*)"/);
            if (logoMatch) {
                item.poster = logoMatch[1];
            }
            
            // Extrair group-title (categoria)
            const groupMatch = attrs.match(/group-title="([^"]*)"/);
            if (groupMatch) {
                item.category = groupMatch[1];
            } else {
                // Tentar extrair categoria do nome
                item.category = extractCategoryFromName(item.title);
            }
            
            return item;
        }

        function extractCategoryFromName(name) {
            const categoryKeywords = {
                'FILME': 'Filmes',
                'SÉRIE': 'Séries',
                'SERIE': 'Séries',
                'ESPORTE': 'Esportes',
                'NOTÍCIA': 'Notícias',
                'NOTICIA': 'Notícias',
                'INFANTIL': 'Infantil',
                'DESENHO': 'Infantil',
                'MUSICA': 'Música',
                'DOCUMENTÁRIO': 'Documentários',
                'DOCUMENTARIO': 'Documentários',
                'RELIGIOSO': 'Religioso',
                'ADULTO': 'Adulto'
            };
            
            const upperName = name.toUpperCase();
            for (const [keyword, category] of Object.entries(categoryKeywords)) {
                if (upperName.includes(keyword)) {
                    return category;
                }
            }
            
            return 'Geral';
        }

        function showDetectedCategories(categories, counts) {
            const container = document.getElementById('detectedCategories');
            container.innerHTML = '';
            
            categories.forEach(category => {
                const count = counts[category] || 0;
                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `
                    <div class="category-card-icon">
                        <i class="fas fa-folder"></i>
                    </div>
                    <div class="category-card-title">${category}</div>
                    <div class="category-card-count">${count} item(ns)</div>
                `;
                container.appendChild(card);
            });
            
            document.getElementById('detectedCategoriesSection').style.display = 'block';
        }

        function renderImportedContent() {
            const tableBody = document.getElementById('importedContentTable');
            tableBody.innerHTML = '';
            
            // Atualizar dropdown de filtro de categoria
            const categoryFilter = document.getElementById('filterImportedCategory');
            const categories = [...new Set(importedItems.map(item => item.category))];
            
            categoryFilter.innerHTML = '<option value="">Todas Categorias</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
            
            // Renderizar itens
            importedItems.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.title}</td>
                    <td>${item.poster ? `<img src="${item.poster}" width="50" height="50" style="object-fit: cover; border-radius: 4px;">` : 'Sem logo'}</td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">${item.url}</td>
                    <td>${item.type.toUpperCase()}</td>
                    <td>${item.category}</td>
                    <td>
                        <button class="btn btn-sm btn-success-admin" onclick="saveImportedItem('${item.id}')">
                            <i class="fas fa-save"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function filterImportedContent() {
            const categoryFilter = document.getElementById('filterImportedCategory').value;
            const typeFilter = document.getElementById('filterImportedType').value;
            
            const tableBody = document.getElementById('importedContentTable');
            const rows = tableBody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length >= 5) {
                    const category = cells[4].textContent;
                    const type = cells[3].textContent.toLowerCase();
                    
                    let show = true;
                    
                    if (categoryFilter && category !== categoryFilter) {
                        show = false;
                    }
                    
                    if (typeFilter && !type.includes(typeFilter)) {
                        show = false;
                    }
                    
                    row.style.display = show ? '' : 'none';
                }
            });
        }

        function saveImportedItem(itemId) {
            const item = importedItems.find(i => i.id === itemId);
            if (!item) return;
            
            const content = {
                id: 'content_' + Date.now(),
                title: item.title,
                poster: item.poster,
                url: item.url,
                page: item.page,
                category: item.category,
                type: item.type,
                addedBy: currentAdmin.username,
                addedDate: new Date().toISOString(),
                status: 'active',
                format: item.url.includes('.m3u8') ? 'm3u8' : 'mp4'
            };
            
            adminData.contents.push(content);
            saveAdminData();
            updateDashboard();
            
            // Remove from imported items
            importedItems = importedItems.filter(i => i.id !== itemId);
            renderImportedContent();
            
            alert('Item salvo com sucesso!');
        }

        function saveAllImported() {
            if (importedItems.length === 0) {
                alert('Nenhum item para salvar!');
                return;
            }
            
            if (confirm(`Deseja salvar todos os ${importedItems.length} itens?`)) {
                importedItems.forEach(item => {
                    const content = {
                        id: 'content_' + Date.now() + '_' + Math.random(),
                        title: item.title,
                        poster: item.poster,
                        url: item.url,
                        page: item.page,
                        category: item.category,
                        type: item.type,
                        addedBy: currentAdmin.username,
                        addedDate: new Date().toISOString(),
                        status: 'active',
                        format: item.url.includes('.m3u8') ? 'm3u8' : 'mp4'
                    };
                    
                    adminData.contents.push(content);
                });
                
                saveAdminData();
                updateDashboard();
                importedItems = [];
                renderImportedContent();
                
                alert('Todos os itens foram salvos com sucesso!');
            }
        }

        function clearImported() {
            if (importedItems.length === 0) {
                alert('Nenhum item na lista!');
                return;
            }
            
            if (confirm('Tem certeza que deseja limpar a lista de itens importados?')) {
                importedItems = [];
                renderImportedContent();
                document.getElementById('detectedCategoriesSection').style.display = 'none';
            }
        }

        function sendImportedToGithub() {
            if (importedItems.length === 0) {
                alert('Nenhum item para enviar!');
                return;
            }
            
            // Primeiro salvar todos os itens
            saveAllImported();
            
            // Depois enviar para GitHub
            sendToGithub('all');
        }

        // ==============================================
        // NOVAS FUNÇÕES PARA CARREGAR JSON
        // ==============================================
        function previewJsonFiles() {
            const fileInput = document.getElementById('jsonFiles');
            const fileList = document.getElementById('jsonFileList');
            fileList.innerHTML = '';
            
            jsonFilesData = []; // Resetar dados
            
            if (fileInput.files.length > 50) {
                alert('Máximo de 50 arquivos permitidos!');
                fileInput.value = '';
                return;
            }
            
            Array.from(fileInput.files).forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'json-file-item';
                fileItem.innerHTML = `
                    <div class="json-file-name">${file.name}</div>
                    <div class="json-file-size">${(file.size / 1024).toFixed(2)} KB</div>
                `;
                fileList.appendChild(fileItem);
                
                // Ler e armazenar o conteúdo do arquivo
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const jsonData = JSON.parse(e.target.result);
                        jsonFilesData.push({
                            name: file.name,
                            content: jsonData,
                            type: detectJsonType(jsonData)
                        });
                        
                        updateJsonStatus();
                    } catch (error) {
                        console.error(`Erro ao ler arquivo ${file.name}:`, error);
                    }
                };
                reader.readAsText(file);
            });
        }

        function detectJsonType(jsonData) {
            // Detectar tipo baseado na estrutura do JSON
            if (jsonData.category && jsonData.items) {
                const category = jsonData.category.toLowerCase();
                if (category.includes('canal') || category.includes('24h')) {
                    return 'canais';
                } else if (category.includes('filme') || category.includes('filmes')) {
                    return 'filmes';
                } else if (category.includes('série') || category.includes('series') || category.includes('amc')) {
                    return 'series';
                }
            }
            
            // Tentar detectar pelo primeiro item
            if (jsonData.items && jsonData.items.length > 0) {
                const firstItem = jsonData.items[0];
                if (firstItem.tvg_name && firstItem.link && firstItem.link.includes('.ts')) {
                    return 'canais';
                } else if (firstItem.title && firstItem.link && firstItem.link.includes('/series/')) {
                    return 'series';
                }
            }
            
            return 'desconhecido';
        }

        function updateJsonStatus() {
            const fileCount = jsonFilesData.length;
            let itemCount = 0;
            let canaisCount = 0;
            let filmesCount = 0;
            let seriesCount = 0;
            
            jsonFilesData.forEach(file => {
                if (file.content.items) {
                    itemCount += file.content.items.length;
                    
                    switch(file.type) {
                        case 'canais': canaisCount++; break;
                        case 'filmes': filmesCount++; break;
                        case 'series': seriesCount++; break;
                    }
                }
            });
            
            document.getElementById('jsonFileCount').textContent = fileCount;
            document.getElementById('jsonItemCount').textContent = itemCount;
            
            let status = `Arquivos: ${fileCount} | Itens: ${itemCount}`;
            if (canaisCount > 0) status += ` | Canais: ${canaisCount}`;
            if (filmesCount > 0) status += ` | Filmes: ${filmesCount}`;
            if (seriesCount > 0) status += ` | Séries: ${seriesCount}`;
            
            document.getElementById('jsonStatus').textContent = status;
        }

        function openJsonModal() {
            if (jsonFilesData.length === 0) {
                alert('Por favor, selecione arquivos JSON primeiro!');
                return;
            }
            
            // Processar os arquivos JSON
            processJsonData();
            
            // Mostrar a modal
            const modal = new bootstrap.Modal(document.getElementById('jsonModal'));
            modal.show();
            
            // Carregar a primeira aba
            switchJsonTab('canais');
        }

        function processJsonData() {
            // Resetar dados processados
            jsonParsedData = {
                canais: [],
                filmes: [],
                series: []
            };
            
            // Processar cada arquivo
            jsonFilesData.forEach(file => {
                const type = file.type;
                const json = file.content;
                
                if (json.category && json.items) {
                    const categoryName = json.category;
                    const items = json.items.map(item => ({
                        ...item,
                        fileSource: file.name,
                        originalCategory: categoryName
                    }));
                    
                    jsonParsedData[type].push({
                        category: categoryName,
                        items: items,
                        totalItems: json.total_items || items.length,
                        fileSource: file.name
                    });
                }
            });
        }

        function switchJsonTab(tabName) {
            currentJsonTab = tabName;
            
            // Atualizar tabs ativas
            document.querySelectorAll('.json-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.json-tab[onclick="switchJsonTab('${tabName}')"]`).classList.add('active');
            
            // Carregar categorias para a aba selecionada
            loadJsonCategories(tabName);
        }

        function loadJsonCategories(tabName) {
            const categoriasList = document.getElementById('jsonCategoriasList');
            categoriasList.innerHTML = '';
            
            const categories = jsonParsedData[tabName];
            
            if (categories.length === 0) {
                categoriasList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-folder-open fa-2x mb-3 text-muted"></i>
                        <p class="text-muted">Nenhuma categoria encontrada</p>
                    </div>
                `;
                return;
            }
            
            categories.forEach((categoryData, index) => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'json-item';
                if (index === 0) {
                    categoryItem.classList.add('selected');
                    selectedJsonCategory = categoryData.category;
                }
                categoryItem.dataset.category = categoryData.category;
                categoryItem.innerHTML = `
                    <div class="json-item-title">${categoryData.category}</div>
                    <div class="json-item-category">
                        ${categoryData.totalItems} itens | ${categoryData.fileSource}
                    </div>
                `;
                categoryItem.addEventListener('click', () => {
                    document.querySelectorAll('#jsonCategoriasList .json-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    categoryItem.classList.add('selected');
                    selectedJsonCategory = categoryData.category;
                    loadJsonContents(tabName, categoryData.category);
                });
                categoriasList.appendChild(categoryItem);
            });
            
            // Carregar conteúdos da primeira categoria
            if (categories.length > 0) {
                loadJsonContents(tabName, categories[0].category);
            }
        }

        function loadJsonContents(tabName, categoryName) {
            const conteudosList = document.getElementById('jsonConteudosList');
            conteudosList.innerHTML = '';
            
            const categoryData = jsonParsedData[tabName].find(cat => cat.category === categoryName);
            
            if (!categoryData || !categoryData.items) {
                conteudosList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-list fa-2x mb-3 text-muted"></i>
                        <p class="text-muted">Nenhum conteúdo encontrado</p>
                    </div>
                `;
                return;
            }
            
            categoryData.items.forEach((item, index) => {
                const contentItem = document.createElement('div');
                contentItem.className = 'json-item';
                if (index === 0) {
                    contentItem.classList.add('selected');
                    selectedJsonItem = item;
                    updateJsonPreview(item);
                }
                contentItem.dataset.id = index;
                contentItem.innerHTML = `
                    <div class="json-item-title">${item.title}</div>
                    <div class="json-item-category">
                        ${item.category || 'Sem categoria'}
                    </div>
                `;
                contentItem.addEventListener('click', () => {
                    document.querySelectorAll('#jsonConteudosList .json-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    contentItem.classList.add('selected');
                    selectedJsonItem = item;
                    updateJsonPreview(item);
                });
                conteudosList.appendChild(contentItem);
            });
        }

        function updateJsonPreview(item) {
            const previewContent = document.getElementById('jsonPreviewContent');
            
            previewContent.innerHTML = `
                <div class="text-center mb-3">
                    ${item.thumbnail ? 
                        `<img src="${item.thumbnail}" alt="${item.title}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">` :
                        `<div style="width: 100%; height: 200px; background: var(--card-bg); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-tv fa-3x text-muted"></i>
                        </div>`
                    }
                </div>
                <h5>${item.title}</h5>
                <p><strong>Categoria:</strong> ${item.category || 'Não informada'}</p>
                <p><strong>Tipo:</strong> ${currentJsonTab.toUpperCase()}</p>
                <p><strong>Arquivo:</strong> ${item.fileSource || 'Desconhecido'}</p>
                <div class="mt-3">
                    <button class="btn btn-sm btn-primary-admin w-100" onclick="testJsonStream('${item.link}')">
                        <i class="fas fa-play me-2"></i>Testar Stream
                    </button>
                </div>
            `;
        }

        function testJsonStream(url) {
            showLoading('Testando stream...');
            
            // Simulação de teste de stream
            setTimeout(() => {
                hideLoading();
                alert(`Stream testado: ${url}\n\nO link parece estar acessível.`);
            }, 1500);
        }

        function addSelectedJsonItem() {
            if (!selectedJsonItem) {
                alert('Por favor, selecione um item primeiro!');
                return;
            }
            
            const item = selectedJsonItem;
            let page = 'tv';
            let category = item.category || 'Geral';
            
            // Determinar página baseada no tipo
            switch(currentJsonTab) {
                case 'canais': page = 'tv'; break;
                case 'filmes': page = 'filmes'; break;
                case 'series': page = 'series'; break;
            }
            
            // Limpar categoria de símbolos
            category = category.replace(/[♦️♣️]/g, '').trim();
            
            const content = {
                id: 'json_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                title: item.title,
                poster: item.thumbnail || item.poster || '',
                url: item.link,
                description: item.description || `Importado de ${item.fileSource || 'JSON'}`,
                format: determineFormat(item.link),
                page: page,
                category: category,
                addedBy: currentAdmin.username,
                addedDate: new Date().toISOString(),
                status: 'active',
                fromJSON: true,
                tvgName: item.tvg_name || ''
            };
            
            adminData.contents.push(content);
            saveAdminData();
            updateDashboard();
            
            alert(`"${item.title}" adicionado com sucesso!\nPágina: ${page.toUpperCase()}\nCategoria: ${category}`);
        }

        function addAllJsonCategory() {
            if (!selectedJsonCategory) {
                alert('Por favor, selecione uma categoria primeiro!');
                return;
            }
            
            const categoryData = jsonParsedData[currentJsonTab].find(cat => cat.category === selectedJsonCategory);
            
            if (!categoryData || !categoryData.items) {
                alert('Nenhum item encontrado nesta categoria!');
                return;
            }
            
            if (!confirm(`Deseja adicionar todos os ${categoryData.items.length} itens da categoria "${selectedJsonCategory}"?`)) {
                return;
            }
            
            let page = 'tv';
            switch(currentJsonTab) {
                case 'canais': page = 'tv'; break;
                case 'filmes': page = 'filmes'; break;
                case 'series': page = 'series'; break;
            }
            
            let addedCount = 0;
            
            categoryData.items.forEach(item => {
                const category = item.category.replace(/[♦️♣️]/g, '').trim();
                
                const content = {
                    id: 'json_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    title: item.title,
                    poster: item.thumbnail || item.poster || '',
                    url: item.link,
                    description: item.description || `Importado de ${item.fileSource || 'JSON'}`,
                    format: determineFormat(item.link),
                    page: page,
                    category: category,
                    addedBy: currentAdmin.username,
                    addedDate: new Date().toISOString(),
                    status: 'active',
                    fromJSON: true,
                    tvgName: item.tvg_name || ''
                };
                
                adminData.contents.push(content);
                addedCount++;
            });
            
            saveAdminData();
            updateDashboard();
            loadAllContents();
            renderContentsGrid();
            
            alert(`${addedCount} itens da categoria "${selectedJsonCategory}" adicionados com sucesso!`);
        }

        function processAllJsonFiles() {
            if (jsonFilesData.length === 0) {
                alert('Nenhum arquivo JSON para processar!');
                return;
            }
            
            if (!confirm(`Deseja processar todos os ${jsonFilesData.length} arquivos JSON?`)) {
                return;
            }
            
            showLoading('Processando todos os arquivos JSON...');
            
            let totalAdded = 0;
            
            // Processar cada tipo de arquivo
            ['canais', 'filmes', 'series'].forEach(tabName => {
                const categories = jsonParsedData[tabName];
                
                let page = 'tv';
                switch(tabName) {
                    case 'canais': page = 'tv'; break;
                    case 'filmes': page = 'filmes'; break;
                    case 'series': page = 'series'; break;
                }
                
                categories.forEach(categoryData => {
                    categoryData.items.forEach(item => {
                        const category = item.category.replace(/[♦️♣️]/g, '').trim();
                        
                        const content = {
                            id: 'json_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                            title: item.title,
                            poster: item.thumbnail || item.poster || '',
                            url: item.link,
                            description: item.description || `Importado de ${item.fileSource || 'JSON'}`,
                            format: determineFormat(item.link),
                            page: page,
                            category: category,
                            addedBy: currentAdmin.username,
                            addedDate: new Date().toISOString(),
                            status: 'active',
                            fromJSON: true,
                            tvgName: item.tvg_name || ''
                        };
                        
                        adminData.contents.push(content);
                        totalAdded++;
                    });
                });
            });
            
            setTimeout(() => {
                saveAdminData();
                updateDashboard();
                loadAllContents();
                renderContentsGrid();
                hideLoading();
                
                alert(`Processamento completo!\n${totalAdded} itens adicionados ao sistema.`);
                
                // Fechar modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('jsonModal'));
                modal.hide();
            }, 1000);
        }

        function saveAllJsonToSystem() {
            processAllJsonFiles();
        }

        function determineFormat(url) {
            if (url.includes('.m3u8')) return 'm3u8';
            if (url.includes('.mp4')) return 'mp4';
            if (url.includes('.ts')) return 'ts';
            return 'm3u8';
        }

        function processJsonFiles() {
            openJsonModal();
        }

        function clearJsonFiles() {
            document.getElementById('jsonFiles').value = '';
            document.getElementById('jsonFileList').innerHTML = '';
            jsonFilesData = [];
            updateJsonStatus();
        }

        // ==============================================
        // FUNÇÕES DE CONFIGURAÇÕES
        // ==============================================
        function toggleTMDBVisibility() {
            const input = document.getElementById('tmdbApiKey');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        function editTMDBKey() {
            const input = document.getElementById('tmdbApiKey');
            const newKey = prompt('Digite a nova chave da API TMDB:', input.value);
            if (newKey !== null) {
                input.value = newKey;
                adminData.settings.tmdbApiKey = newKey;
                saveAdminData();
                alert('Chave TMDB atualizada com sucesso!');
            }
        }

        function toggleSettingsTokenVisibility() {
            const input = document.getElementById('settingsGithubToken');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        function editSettingsToken() {
            const input = document.getElementById('settingsGithubToken');
            const newToken = prompt('Digite o novo token do GitHub:', input.value);
            if (newToken !== null) {
                input.value = newToken;
                adminData.settings.githubToken = newToken;
                document.getElementById('githubToken').value = newToken;
                saveAdminData();
                alert('Token GitHub atualizado com sucesso!');
            }
        }

        function saveSettings() {
            adminData.settings.tmdbApiKey = document.getElementById('tmdbApiKey').value;
            adminData.settings.githubToken = document.getElementById('settingsGithubToken').value;
            adminData.settings.sessionTimeout = parseInt(document.getElementById('sessionTimeout').value);
            adminData.settings.maxProfiles = parseInt(document.getElementById('maxProfiles').value);
            adminData.settings.enableRegistration = document.getElementById('enableRegistration').checked;
            adminData.settings.enableAutoSync = document.getElementById('enableAutoSync').checked;
            adminData.settings.allowedIPs = document.getElementById('allowedIPs').value;
            
            saveAdminData();
            
            alert('Configurações salvas com sucesso!');
        }

        function saveTempCategorySettings() {
            adminData.settings.tempCategoryCheckInterval = parseInt(document.getElementById('tempCategoryCheckInterval').value);
            adminData.settings.enableTempCategories = document.getElementById('enableTempCategories').checked;
            adminData.settings.archiveExpiredCategories = document.getElementById('archiveExpiredCategories').checked;
            
            saveAdminData();
            
            // Reiniciar verificador
            startTempCategoryChecker();
            
            alert('Configurações de categorias temporárias salvas!');
        }

        function changeAdminPassword() {
            const newPassword = document.getElementById('newAdminPassword').value;
            const confirmPassword = document.getElementById('confirmAdminPassword').value;
            
            if (!newPassword || !confirmPassword) {
                alert('Por favor, preencha ambos os campos de senha!');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('As senhas não coincidem!');
                return;
            }
            
            // Update current admin password
            const adminIndex = adminData.users.findIndex(u => u.id === currentAdmin.id);
            if (adminIndex !== -1) {
                adminData.users[adminIndex].password = newPassword;
                saveAdminData();
                
                // Clear fields
                document.getElementById('newAdminPassword').value = '';
                document.getElementById('confirmAdminPassword').value = '';
                
                alert('Senha do administrador alterada com sucesso!');
            }
        }

        function clearAllData() {
            if (confirm('ATENÇÃO: Esta ação irá apagar TODOS os dados do sistema. Tem certeza?')) {
                if (confirm('CONFIRMAÇÃO FINAL: Esta ação não pode ser desfeita. Continuar?')) {
                    localStorage.removeItem(ADMIN_STORAGE_KEY);
                    localStorage.removeItem('current_admin');
                    alert('Todos os dados foram apagados. A página será recarregada.');
                    window.location.reload();
                }
            }
        }

        function createBackup() {
            const backup = JSON.stringify(adminData, null, 2);
            const blob = new Blob([backup], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `FLIX TV max_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
            
            document.getElementById('backupStatus').innerHTML = `
                <div class="alert alert-success-admin mt-3">
                    <i class="fas fa-check-circle me-2"></i>
                    Backup criado com sucesso!
                </div>
            `;
        }

        function restoreBackup() {
            const fileInput = document.getElementById('restoreFile');
            if (!fileInput.files.length) {
                alert('Por favor, selecione um arquivo de backup!');
                return;
            }
            
            if (!confirm('ATENÇÃO: Esta ação irá substituir todos os dados atuais. Tem certeza?')) {
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // Validate backup structure
                    if (!backupData.contents || !backupData.users) {
                        throw new Error('Arquivo de backup inválido!');
                    }
                    
                    localStorage.setItem(ADMIN_STORAGE_KEY, JSON.stringify(backupData));
                    
                    document.getElementById('backupStatus').innerHTML = `
                        <div class="alert alert-success-admin mt-3">
                            <i class="fas fa-check-circle me-2"></i>
                            Backup restaurado com sucesso! A página será recarregada.
                        </div>
                    `;
                    
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                    
                } catch (error) {
                    document.getElementById('backupStatus').innerHTML = `
                        <div class="alert alert-danger-admin mt-3">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            Erro ao restaurar backup: ${error.message}
                        </div>
                    `;
                }
            };
            
            reader.readAsText(file);
        }

        // ==============================================
        // FUNÇÕES DE CATEGORIAS TEMPORÁRIAS
        // ==============================================
        function createNewCategory() {
            const modal = new bootstrap.Modal(document.getElementById('newCategoryModal'));
            modal.show();
        }

        function saveNewCategory() {
            const name = document.getElementById('newCategoryName').value;
            const page = document.getElementById('newCategoryPage').value;
            const isTemp = document.getElementById('newCategoryIsTemp').checked;
            
            if (!name || !page) {
                alert('Por favor, preencha todos os campos!');
                return;
            }
            
            if (isTemp) {
                const startDate = document.getElementById('newCategoryStartDate').value;
                const startTime = document.getElementById('newCategoryStartTime').value;
                const duration = parseInt(document.getElementById('newCategoryDuration').value);
                
                if (!startDate || !startTime) {
                    alert('Por favor, preencha data e hora de início!');
                    return;
                }
                
                const startDateTime = new Date(`${startDate}T${startTime}`);
                const endDateTime = new Date(startDateTime);
                endDateTime.setDate(endDateTime.getDate() + duration);
                
                const tempCategory = {
                    id: 'tempcat_' + Date.now(),
                    name: name,
                    page: page,
                    startDate: startDateTime.toISOString(),
                    endDate: endDateTime.toISOString(),
                    status: 'active',
                    createdBy: currentAdmin.username,
                    created: new Date().toISOString()
                };
                
                adminData.tempCategories.push(tempCategory);
                saveAdminData();
                updateDashboard();
                
                alert('Categoria temporária criada com sucesso!');
                
            } else {
                // Adicionar à lista de categorias padrão
                if (!CATEGORIES_BY_PAGE[page]) {
                    CATEGORIES_BY_PAGE[page] = [];
                }
                
                if (Array.isArray(CATEGORIES_BY_PAGE[page])) {
                    CATEGORIES_BY_PAGE[page].push(name);
                } else {
                    // Se for objeto, adicionar à primeira seção
                    const firstKey = Object.keys(CATEGORIES_BY_PAGE[page])[0];
                    if (firstKey) {
                        CATEGORIES_BY_PAGE[page][firstKey].push(name);
                    }
                }
                
                alert('Categoria criada com sucesso!');
            }
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('newCategoryModal'));
            modal.hide();
            
            // Reset form
            document.getElementById('newCategoryForm').reset();
            
            // Atualizar interface
            updateCategoriesByPage();
            renderCategoriesGrid(currentPage);
        }

        function createTempCategory(e) {
            e.preventDefault();
            
            const name = document.getElementById('tempCategoryName').value;
            const page = document.getElementById('tempCategoryPage').value;
            const duration = parseInt(document.getElementById('tempCategoryDuration').value);
            const startDate = document.getElementById('tempCategoryStartDate').value;
            const startTime = document.getElementById('tempCategoryStartTime').value;
            
            if (!name || !page || !startDate || !startTime) {
                alert('Por favor, preencha todos os campos!');
                return;
            }
            
            const startDateTime = new Date(`${startDate}T${startTime}`);
            const endDateTime = new Date(startDateTime);
            endDateTime.setDate(endDateTime.getDate() + duration);
            
            const tempCategory = {
                id: 'tempcat_' + Date.now(),
                name: name,
                page: page,
                startDate: startDateTime.toISOString(),
                endDate: endDateTime.toISOString(),
                status: 'scheduled',
                createdBy: currentAdmin.username,
                created: new Date().toISOString()
            };
            
            adminData.tempCategories.push(tempCategory);
            saveAdminData();
            updateDashboard();
            loadTempCategories();
            
            alert('Categoria temporária criada com sucesso!');
            
            // Reset form
            document.getElementById('tempCategoryForm').reset();
        }

        function scheduleTempCategory() {
            // Similar a createTempCategory, mas para agendamento
            createTempCategory(new Event('submit'));
        }

        function loadTempCategories() {
            adminData.stats.tempCategoriesCount = adminData.tempCategories.filter(cat => 
                cat.status === 'active'
            ).length;
            updateDashboard();
        }

        function loadTempCategoriesTable() {
            const tableBody = document.getElementById('tempCategoriesTable');
            tableBody.innerHTML = '';
            
            adminData.tempCategories.forEach(category => {
                const startDate = new Date(category.startDate);
                const endDate = new Date(category.endDate);
                const now = new Date();
                
                let status = category.status;
                let statusClass = 'status-active';
                
                if (category.status === 'scheduled' && now >= startDate) {
                    status = 'active';
                    category.status = 'active';
                } else if (category.status === 'active' && now >= endDate) {
                    status = 'expired';
                    category.status = 'expired';
                    statusClass = 'status-inactive';
                } else if (category.status === 'scheduled') {
                    statusClass = 'status-warning';
                } else if (category.status === 'expired') {
                    statusClass = 'status-inactive';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${category.name}</td>
                    <td>${category.page.toUpperCase()}</td>
                    <td>${startDate.toLocaleString()}</td>
                    <td>${endDate.toLocaleString()}</td>
                    <td><span class="status-badge ${statusClass}">${status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary-admin me-1" onclick="editTempCategory('${category.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger-admin" onclick="deleteTempCategory('${category.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        ${category.status === 'expired' ? 
                            `<button class="btn btn-sm btn-success-admin ms-1" onclick="restoreTempCategory('${category.id}')">
                                <i class="fas fa-redo"></i>
                            </button>` : ''
                        }
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            saveAdminData();
        }

        function editTempCategory(categoryId) {
            const category = adminData.tempCategories.find(c => c.id === categoryId);
            if (!category) return;
            
            // Implementar edição (simplificado)
            const newName = prompt('Novo nome da categoria:', category.name);
            if (newName) {
                category.name = newName;
                saveAdminData();
                loadTempCategoriesTable();
                renderCategoriesGrid(currentPage);
                alert('Categoria atualizada!');
            }
        }

        function deleteTempCategory(categoryId) {
            if (confirm('Tem certeza que deseja excluir esta categoria temporária?')) {
                adminData.tempCategories = adminData.tempCategories.filter(c => c.id !== categoryId);
                saveAdminData();
                loadTempCategories();
                loadTempCategoriesTable();
                renderCategoriesGrid(currentPage);
                alert('Categoria excluída!');
            }
        }

        function restoreTempCategory(categoryId) {
            const category = adminData.tempCategories.find(c => c.id === categoryId);
            if (!category) return;
            
            const newDuration = prompt('Nova duração (dias):', 7);
            if (newDuration) {
                const newEndDate = new Date();
                newEndDate.setDate(newEndDate.getDate() + parseInt(newDuration));
                
                category.startDate = new Date().toISOString();
                category.endDate = newEndDate.toISOString();
                category.status = 'active';
                
                saveAdminData();
                loadTempCategories();
                loadTempCategoriesTable();
                renderCategoriesGrid(currentPage);
                alert('Categoria restaurada!');
            }
        }

        function checkTempCategories() {
            const now = new Date();
            let updated = false;
            
            adminData.tempCategories.forEach(category => {
                const startDate = new Date(category.startDate);
                const endDate = new Date(category.endDate);
                
                if (category.status === 'scheduled' && now >= startDate) {
                    category.status = 'active';
                    updated = true;
                } else if (category.status === 'active' && now >= endDate) {
                    category.status = 'expired';
                    updated = true;
                    
                    // Arquivar se configurado
                    if (adminData.settings.archiveExpiredCategories) {
                        adminData.archivedCategories.push({
                            ...category,
                            archivedAt: new Date().toISOString()
                        });
                    }
                }
            });
            
            if (updated) {
                saveAdminData();
                loadTempCategories();
                loadTempCategoriesTable();
                renderCategoriesGrid(currentPage);
                alert('Categorias temporárias verificadas e atualizadas!');
            } else {
                alert('Nenhuma alteração necessária nas categorias temporárias.');
            }
        }

        function startTempCategoryChecker() {
            // Limpar intervalo anterior
            if (tempCategoryCheckInterval) {
                clearInterval(tempCategoryCheckInterval);
            }
            
            // Iniciar novo intervalo
            const interval = adminData.settings.tempCategoryCheckInterval * 60 * 1000; // converter para milissegundos
            if (adminData.settings.enableTempCategories && interval > 0) {
                tempCategoryCheckInterval = setInterval(() => {
                    checkTempCategories();
                }, interval);
                
                console.log(`Verificador de categorias temporárias iniciado (${interval/60000} minutos)`);
            }
        }

        function openTempCategoryManager() {
            // Mudar para a aba de categorias temporárias
            const tab = document.querySelector('a[href="#tabTemp"]');
            if (tab) {
                tab.click();
            }
        }

        function createTempCategoryModal() {
            const modal = new bootstrap.Modal(document.getElementById('newCategoryModal'));
            
            // Configurar como temporária
            document.getElementById('newCategoryIsTemp').checked = true;
            document.getElementById('tempCategoryFields').style.display = 'block';
            
            // Preencher datas padrão
            const today = new Date().toISOString().split('T')[0];
            const now = new Date();
            const time = now.getHours().toString().padStart(2, '0') + ':' + 
                        now.getMinutes().toString().padStart(2, '0');
            
            document.getElementById('newCategoryStartDate').value = today;
            document.getElementById('newCategoryStartTime').value = time;
            document.getElementById('newCategoryDuration').value = 7;
            
            modal.show();
        }

        // ==============================================
        // FUNÇÕES AUXILIARES
        // ==============================================
        function showLoading(text) {
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('loadingText').textContent = text;
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // ==============================================
        // INICIALIZAÇÃO
        // ==============================================
        document.addEventListener('DOMContentLoaded', initAdminPanel);
    </script>
</body>
</html>