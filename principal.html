<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Principal</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --primary: #6366f1;
            --border: #e2e8f0;
            --danger: #ef4444;
            --success: #22c55e;
        }

        body.dark-mode {
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f8fafc;
            --border: #334155;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; transition: background 0.3s, color 0.3s; }
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* --- NAVBAR --- */
        .navbar-home {
            padding: 25px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card);
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        .user-info { display: flex; align-items: center; gap: 15px; }
        .profile-pic-home { width: 55px; height: 55px; border-radius: 18px; object-fit: cover; border: 2px solid var(--primary); }
        .user-text h2 { font-size: 1.1rem; font-weight: 700; }
        .user-text p { font-size: 0.85rem; color: var(--primary); font-weight: 600; }

        .nav-buttons { display: flex; gap: 10px; }
        .btn-settings, .btn-bypass-menu {
            background: var(--bg);
            border: none;
            width: 45px; height: 45px; border-radius: 14px;
            cursor: pointer; color: var(--text); font-size: 24px;
            display: flex; align-items: center; justify-content: center;
        }

        /* --- GRID DE APPS --- */
        .menu-grid {
            padding: 30px 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .menu-card {
            background: var(--card);
            padding: 25px 20px;
            border-radius: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: var(--text);
            font-weight: 700;
            border: 1px solid var(--border);
            position: relative;
            cursor: pointer;
        }

        .menu-card.locked { opacity: 0.5; filter: grayscale(0.8); }
        .lock-badge { position: absolute; top: 10px; right: 10px; color: var(--danger); font-size: 18px; }

        /* --- TELAS FULLSCREEN --- */
        .full-screen {
            position: fixed;
            top: 0; right: -100%;
            width: 100%; height: 100%;
            background: var(--bg);
            z-index: 999; padding: 20px;
            overflow-y: auto;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .full-screen.active { right: 0; }

        /* --- BYPASS LIST --- */
        .bypass-item {
            background: var(--card);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border);
        }

        .btn-unlock {
            background: var(--danger);
            color: white; border: none;
            padding: 10px 18px; border-radius: 10px;
            font-weight: bold; cursor: pointer;
        }

        /* --- STEPS / JOGO --- */
        .step-container { text-align: center; padding-top: 50px; }
        .game-box { 
            background: var(--card); padding: 30px; 
            border-radius: 24px; border: 2px dashed var(--primary);
            margin: 20px 0;
        }

        /* --- CONFIGS --- */
        .acc-item { background: var(--card); border-radius: 16px; margin-bottom: 12px; border: 1px solid var(--border); overflow: hidden; }
        .acc-header { padding: 20px; display: flex; justify-content: space-between; cursor: pointer; font-weight: 600; }
        .acc-content { max-height: 0; overflow: hidden; padding: 0 20px; transition: 0.3s ease-out; }
        .acc-item.open .acc-content { max-height: 500px; padding: 20px; border-top: 1px solid var(--border); }
        .theme-btn { padding: 12px; width: 100%; border-radius: 10px; border: none; margin-bottom: 8px; background: var(--bg); color: var(--text); font-weight: 600; cursor: pointer; }
        .btn-logout { width: 100%; margin-top: 20px; padding: 15px; border-radius: 12px; border: none; background: #fee2e2; color: #ef4444; font-weight: 700; cursor: pointer; }
    </style>
</head>
<body>

<div class="navbar-home">
    <div class="user-info">
        <img id="home-avatar" src="" alt="" class="profile-pic-home">
        <div class="user-text">
            <h2 id="home-name">Carregando...</h2>
            <p id="display-rank">Bypass Ativo</p>
        </div>
    </div>
    <div class="nav-buttons">
        <button class="btn-bypass-menu" onclick="openBypassMenu()"><i class="ph ph-shield-check"></i></button>
        <button class="btn-settings" onclick="openConfig()"><i class="ph ph-gear-six"></i></button>
    </div>
</div>

<div class="menu-grid" id="apps-grid">
    </div>

<div id="bypass-screen" class="full-screen">
    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 30px;">
        <button onclick="closeBypassMenu()" style="background:none; border:none; font-size: 24px; color: var(--text)"><i class="ph ph-caret-left"></i></button>
        <h2 style="font-weight: 700;">Segurança do Sistema</h2>
    </div>
    <div id="bypass-list"></div>
</div>

<div id="steps-screen" class="full-screen" style="z-index: 1000;">
    <div class="step-container">
        <p style="color:var(--primary); font-weight:800">PASSO <span id="current-step-num">1</span> DE 7</p>
        <div id="step-content"></div>
    </div>
</div>

<div id="config-screen" class="full-screen">
    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 30px;">
        <button onclick="closeConfig()" style="background:none; border:none; font-size: 24px; color: var(--text)"><i class="ph ph-caret-left"></i></button>
        <h2 style="font-weight: 700;">Configurações</h2>
    </div>

    <div class="acc-item" id="adm-panel" style="display: none;">
        <div class="acc-header" onclick="toggleAcc(this)"><span>ADMINISTRAÇÃO</span><i class="ph ph-crown"></i></div>
        <div class="acc-content">
            <button class="theme-btn" style="background: var(--primary); color: white;" onclick="generateKey()">GERAR NOVA KEY</button>
            <div id="codes-output" style="margin-top:10px; display:none; padding:10px; background:#000; color:#0f0; border-radius:8px; text-align:center; font-family:monospace"></div>
        </div>
    </div>

    <div class="acc-item">
        <div class="acc-header" onclick="toggleAcc(this)"><span>APARÊNCIA</span><i class="ph ph-palette"></i></div>
        <div class="acc-content">
            <button class="theme-btn" onclick="setTheme('light')">Modo Claro</button>
            <button class="theme-btn" onclick="setTheme('dark')">Modo Escuro</button>
        </div>
    </div>

    <button class="btn-logout" onclick="logout()">Sair do Sistema</button>
</div>

<script>
    // Configuração dos Apps e Pacotes Android
    const APP_CONFIG = [
        { id: "Bypass-Instagram", name: "INSTAGRAM", icon: "ph-instagram-logo", color: "#E1306C", package: "com.instagram.android" },
        { id: "Bypass-tiktok", name: "TIKTOK", icon: "ph-tiktok-logo", color: "#000000", package: "com.zhiliaoapp.musically" },
        { id: "Bypass-roblox", name: "ROBLOX", icon: "ph-game-controller", color: "#00A2FF", package: "com.roblox.client" },
        { id: "Bypass-freefire", name: "FREE FIRE", icon: "ph-fire", color: "#FF4500", package: "com.dts.freefireth" }
    ];

    const initialData = {
        "nome": "pão", "usuario": "pãozinho15", "Permissão": "dono",
        "foto": "https://i.pravatar.cc/150?u=pao",
        "Bypass-Instagram": "FALSE", "Bypass-tiktok": "FALSE", 
        "Bypass-freefire": "FALSE", "Bypass-roblox": "FALSE"
    };

    let session = JSON.parse(localStorage.getItem('session')) || initialData;
    let currentStep = 1;
    let targetKey = "";

    function init() {
        document.getElementById('home-name').textContent = session.nome;
        document.getElementById('home-avatar').src = session.foto;
        document.getElementById('display-rank').textContent = `Rank: ${session.Permissão.toUpperCase()}`;

        if(session.Permissão === 'dono' || session.Permissão === 'adm') {
            document.getElementById('adm-panel').style.display = 'block';
        }

        if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
        
        renderApps();
        renderBypassList();
    }

    // Renderiza os Cards da Tela Inicial
    function renderApps() {
        const grid = document.getElementById('apps-grid');
        grid.innerHTML = "";

        APP_CONFIG.forEach(app => {
            const unlocked = session[app.id] === "TRUE";
            grid.innerHTML += `
                <div class="menu-card ${unlocked ? '' : 'locked'}" onclick="launchApp('${app.package}', '${app.id}')">
                    ${!unlocked ? '<i class="ph ph-lock-simple lock-badge"></i>' : ''}
                    <i class="ph ${app.icon}" style="color: ${app.color}; font-size: 38px;"></i>
                    <span>${app.name}</span>
                </div>
            `;
        });
    }

    // Lógica de clicar no App
    function launchApp(packageName, id) {
        if (session[id] === "TRUE") {
            // Tenta abrir o App no Android
            window.location.href = `intent://scan/#Intent;scheme=package;package=${packageName};end`;
        } else {
            Swal.fire("Bloqueado", "Você precisa liberar este app no menu de escudo!", "warning");
        }
    }

    // Lista de Desbloqueio (Escudo)
    function renderBypassList() {
        const list = document.getElementById('bypass-list');
        list.innerHTML = "";

        APP_CONFIG.forEach(app => {
            const unlocked = session[app.id] === "TRUE";
            list.innerHTML += `
                <div class="bypass-item">
                    <div style="display:flex; align-items:center; gap:12px">
                        <i class="ph ${app.icon}" style="font-size:24px; color:${app.color}"></i>
                        <span style="font-weight:bold">${app.name}</span>
                    </div>
                    ${unlocked ? 
                        '<i class="ph ph-check-circle" style="color:var(--success); font-size:28px"></i>' : 
                        `<button class="btn-unlock" onclick="startChallenge('${app.id}')">LIBERAR</button>`}
                </div>
            `;
        });
    }

    function startChallenge(id) {
        targetKey = id;
        currentStep = 1;
        document.getElementById('steps-screen').classList.add('active');
        showStep();
    }

    function showStep() {
        const content = document.getElementById('step-content');
        document.getElementById('current-step-num').textContent = currentStep;

        if ([1, 3, 5, 7].includes(currentStep)) {
            content.innerHTML = `
                <h3 style="margin-top:20px">Validação de Segurança</h3>
                <p style="margin-bottom:20px">Insira a KEY do Administrador</p>
                <input type="text" id="key-input" class="input-code" placeholder="DIGITE A KEY">
                <button class="theme-btn" onclick="checkKey()" style="background:var(--primary); color:white">Confirmar</button>
                <button onclick="closeChallenge()" style="background:none; border:none; color:var(--danger); margin-top:15px; font-weight:bold">CANCELAR</button>
            `;
        } else {
            content.innerHTML = `
                <div class="game-box">
                    <h3>Injeção de Bypass</h3>
                    <p>Clique rápido 10 vezes para injetar os pacotes!</p>
                    <div id="click-count" style="font-size:3rem; font-weight:800; margin:20px 0">0</div>
                    <button class="theme-btn" onclick="handleGameClick()" style="background:var(--success); color:white; height:60px">CLICAR</button>
                </div>
            `;
        }
    }

    function checkKey() {
        const input = document.getElementById('key-input').value;
        const validKeys = JSON.parse(localStorage.getItem('validKeys')) || [];
        
        // Verifica se a chave existe
        const index = validKeys.indexOf(input);
        if (index > -1 || input === "DEBUG123") { // DEBUG123 é uma chave mestra para você testar
            nextStep();
        } else {
            Swal.fire("Erro", "Key inválida!", "error");
        }
    }

    let clicks = 0;
    function handleGameClick() {
        clicks++;
        document.getElementById('click-count').textContent = clicks;
        if(clicks >= 10) { clicks = 0; nextStep(); }
    }

    function nextStep() {
        if(currentStep < 7) {
            currentStep++;
            showStep();
        } else {
            completeUnlock();
        }
    }

    function completeUnlock() {
        // AQUI ESTÁ A CORREÇÃO: SALVAR NO JSON E NO STORAGE
        session[targetKey] = "TRUE";
        localStorage.setItem('session', JSON.stringify(session));

        Swal.fire("Sucesso!", "Aplicativo Desbloqueado!", "success");
        document.getElementById('steps-screen').classList.remove('active');
        
        renderApps(); // Atualiza a tela principal
        renderBypassList(); // Atualiza a lista do escudo
    }

    function generateKey() {
        const newKey = "BYP-" + Math.floor(1000 + Math.random() * 9000);
        let keys = JSON.parse(localStorage.getItem('validKeys')) || [];
        keys.push(newKey);
        localStorage.setItem('validKeys', JSON.stringify(keys));

        const out = document.getElementById('codes-output');
        out.style.display = "block";
        out.textContent = newKey;
        Swal.fire("Gerado!", "Key: " + newKey, "success");
    }

    // Utilitários
    function closeChallenge() { document.getElementById('steps-screen').classList.remove('active'); }
    function openBypassMenu() { document.getElementById('bypass-screen').classList.add('active'); }
    function closeBypassMenu() { document.getElementById('bypass-screen').classList.remove('active'); }
    function openConfig() { document.getElementById('config-screen').classList.add('active'); }
    function closeConfig() { document.getElementById('config-screen').classList.remove('active'); }
    function toggleAcc(el) { el.parentElement.classList.toggle('open'); }
    function setTheme(m) { document.body.classList.toggle('dark-mode', m==='dark'); localStorage.setItem('theme', m); }
    function logout() { localStorage.removeItem('session'); location.reload(); }

    init();
</script>
</body>
</html>
